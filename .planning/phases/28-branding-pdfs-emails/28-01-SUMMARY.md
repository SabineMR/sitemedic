# 28-01 Summary: Shared PDF Branding Infrastructure + Weekly Report Pilot

**Status:** Complete
**Duration:** ~3 min

## What Was Built

### Shared Infrastructure (`_shared/`)
- **`branding-helpers.ts`**: `OrgBranding` interface, `fetchOrgBranding()` (parallel queries to org_branding + organizations), `fetchLogoAsDataUri()` (ArrayBuffer → base64 data URI fallback), `showPoweredBySiteMedic()` tier check
- **`pdf-branding.tsx`**: `BrandedPdfHeader` (logo + company name + document type with em dash, or text-only fallback when no logo), `BrandedPdfFooter` (tier-conditional "Powered by SiteMedic | sitemedic.co.uk" with page numbers)

### Weekly Report Pilot
- `index.tsx`: Fetches branding after orgId resolved, converts logo to data URI, passes branding + logoSrc to ReportDocument
- `ReportDocument.tsx`: Accepts required `branding: OrgBranding` and optional `logoSrc` props, passes to Header and Footer
- `Header.tsx`: Uses `BrandedPdfHeader` component, removed hardcoded "SiteMedic" logo placeholder
- `Footer.tsx`: Uses `BrandedPdfFooter` component, removed hardcoded "Generated by SiteMedic" text

## Commits

| Hash | Message |
|------|---------|
| 0849fb3 | feat(28-01): create shared PDF branding infrastructure |
| d1ca9ae | feat(28-01): integrate org branding into generate-weekly-report |

## Key Decisions

- **Data URI approach chosen directly** — skipped remote URL testing for @react-pdf Image in Deno Edge (MEDIUM confidence risk). Data URI is the reliable path; remote URL optimization can be added later if needed.
- **Parallel branding queries** — fetchOrgBranding runs org_branding + organizations queries in parallel with Promise.all for performance
- **Chunked base64 encoding** — fetchLogoAsDataUri uses 8KB chunks to avoid stack overflow on large logo images
- **BrandedPdfHeader dual layout** — logo present: logo left + company name right; no logo: single-line "{Company} — {DocumentType}" text header

## Deviations

None.

## Issues

None.
