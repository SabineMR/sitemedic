---
phase: 05.5-admin-operations
plan: 02
subsystem: admin-ui
tags: [tanstack-query, tanstack-table, react, typescript, supabase, admin-dashboard]

# Dependency graph
requires:
  - phase: 01.5-business-foundation
    provides: Database schema with medics, bookings, and territories tables
provides:
  - Medic roster table with utilization metrics and availability management
  - TanStack Query hooks for medics with 60s polling
  - Territory assignment visualization with primary/secondary roles
  - Availability toggle with reason capture
affects: [05.5-admin-operations, admin-workforce-management]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - TanStack Query hooks pattern for admin data with optimistic updates
    - Parallel query execution with Promise.all to avoid N+1
    - Utilization calculation based on weekly booking counts

key-files:
  created:
    - web/lib/queries/admin/medics.ts
    - web/components/admin/medic-roster-table.tsx
  modified:
    - web/app/admin/medics/page.tsx
    - web/app/admin/layout.tsx

key-decisions:
  - "Use TanStack Query for data fetching with 60-second polling for near-real-time updates"
  - "Calculate utilization as (confirmed bookings this week / 5 working days) × 100, capped at 100%"
  - "Color-code utilization: green <50%, yellow 50-80%, red >80% for quick visual assessment"
  - "Use parallel queries (Promise.all) to avoid N+1 database calls when fetching metrics"

patterns-established:
  - "TanStack Query pattern: Server function + React hook + optimistic updates for admin mutations"
  - "Territory display pattern: Show max 3 territories with badges, '+N more' for overflow"
  - "Availability management: Direct toggle for available, dialog with reason for unavailable"

# Metrics
duration: 4min
completed: 2026-02-16
---

# Phase 05.5 Plan 02: Medic Management Dashboard Summary

**Medic roster table with utilization bars, territory assignments, availability toggle, and performance metrics using TanStack Query hooks**

## Performance

- **Duration:** 4 min
- **Started:** 2026-02-16T06:08:23Z
- **Completed:** 2026-02-16T06:12:27Z
- **Tasks:** 2
- **Files modified:** 4

## Accomplishments

- Built medic roster table with color-coded utilization bars (green <50%, yellow 50-80%, red >80%)
- Territory assignments displayed with primary/secondary role indicators
- Availability management with dialog for capturing unavailable reason and date
- Performance metrics visible (star rating, shifts completed, compliance rate)
- TanStack Query hooks with 60-second polling for near-real-time data
- Optimistic updates for availability toggling
- Admin layout wrapped with QueryProvider for TanStack Query support

## Task Commits

Each task was committed atomically:

1. **Task 1: Create medic query hooks with utilization calculation** - `dd502b3` (feat)
2. **Task 2: Build medic roster table with utilization and availability management** - `6abe10c` (feat)

## Files Created/Modified

- `web/lib/queries/admin/medics.ts` - TanStack Query hooks for medics with utilization calculation, territory assignments, and availability mutations. Uses Promise.all for parallel queries to avoid N+1 issues.
- `web/components/admin/medic-roster-table.tsx` - Admin table component with TanStack Table showing utilization bars, territory badges, availability toggle, performance metrics, and Stripe status. Includes filters and stats row.
- `web/app/admin/medics/page.tsx` - Simplified medics page using MedicRosterTable component
- `web/app/admin/layout.tsx` - Wrapped with QueryProvider for TanStack Query support across all admin pages

## Decisions Made

**1. Utilization calculation method**
- Decided to calculate as (confirmed bookings this week / 5 working days) × 100, capped at 100%
- Week defined as Monday to Sunday
- Only counts confirmed/in_progress bookings (pending excluded)
- Rationale: Simple, understandable metric for workforce capacity planning

**2. Parallel query execution**
- Used Promise.all to fetch territories, bookings this week, and upcoming bookings in parallel
- Avoids N+1 query problem where each medic triggers separate queries
- Rationale: Performance optimization critical for large medic rosters (reduces query time from O(n) to O(1) for n medics)

**3. Optimistic updates for availability**
- Implemented optimistic UI updates before server confirmation
- Rollback on error via onError handler
- Rationale: Improves perceived performance for admin user interactions

**4. Territory overflow handling**
- Display max 3 territory badges, show "+N more" for additional assignments
- Rationale: Prevents table row expansion, maintains clean UI even for medics with many territories

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None - implementation went smoothly. TanStack Query and TanStack Table integrations worked as expected.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

**Ready for:**
- Additional admin operations dashboards (booking management, customer management)
- Medic detail pages with expanded metrics
- Territory management interface

**Data available:**
- Medic roster with utilization metrics
- Territory assignments (primary/secondary)
- Availability status with reasons
- Performance metrics (star rating, shifts, compliance)
- Stripe onboarding status

**No blockers:** All success criteria met. Admin can view medic roster with availability, territories, and utilization.

---
*Phase: 05.5-admin-operations*
*Completed: 2026-02-16*
