---
phase: 21-film-tv-production-vertical
plan: 02
type: execute
wave: 2
depends_on: ["21-01"]
files_modified:
  - services/taxonomy/certification-types.ts
  - web/types/certification.types.ts
  - services/taxonomy/vertical-outcome-labels.ts
  - app/(tabs)/_layout.tsx
  - app/(tabs)/workers.tsx
  - app/worker/new.tsx
  - app/worker/quick-add.tsx
  - app/worker/[id].tsx
  - app/treatment/[id].tsx
  - app/treatment/templates.tsx
autonomous: true

must_haves:
  truths:
    - "When a Film/TV org is active, the Workers tab label and header read 'Cast & Crew' instead of 'Workers' / 'Worker Registry'"
    - "When a Film/TV org is active, worker-creation screens use 'Cast & Crew member' terminology instead of 'Worker'"
    - "The cert profile for a Film/TV medic lists HCPC Paramedic, ScreenSkills Production Safety Passport, FREC 4, and EFR at the top â€” CSCS and IPAF are removed from the tv_film ordering"
    - "The incident-report-dispatcher routes tv_film treatments to riddor-f2508-generator without any code change â€” dispatch verification confirms FILM-04"
    - "treatment/[id].tsx shows 'Cast & Crew member Information' instead of 'Worker Information' when treatment was logged under Film/TV vertical"
  artifacts:
    - path: "services/taxonomy/certification-types.ts"
      provides: "Updated tv_film VERTICAL_CERT_TYPES ordering with new cert types at top"
      contains: "HCPC Paramedic.*ScreenSkills Production Safety Passport.*FREC 4.*EFR"
    - path: "web/types/certification.types.ts"
      provides: "Updated tv_film VERTICAL_CERT_TYPES ordering mirrored for web"
      contains: "HCPC Paramedic.*ScreenSkills Production Safety Passport.*FREC 4.*EFR"
    - path: "services/taxonomy/vertical-outcome-labels.ts"
      provides: "getLocationLabel and getEventLabel helpers for mobile terminology"
      contains: "getLocationLabel\|getEventLabel"
    - path: "app/(tabs)/_layout.tsx"
      provides: "Dynamic Workers tab label driven by OrgContext"
      contains: "useOrg\|primaryVertical"
    - path: "app/(tabs)/workers.tsx"
      provides: "Dynamic Add/empty state labels driven by OrgContext"
      contains: "useOrg\|primaryVertical"
  key_links:
    - from: "app/(tabs)/_layout.tsx"
      to: "src/contexts/OrgContext.tsx"
      via: "useOrg() hook providing primaryVertical"
      pattern: "useOrg.*primaryVertical"
    - from: "services/taxonomy/vertical-outcome-labels.ts (getPatientLabel)"
      to: "app/(tabs)/workers.tsx and worker/*.tsx"
      via: "getPatientLabel(primaryVertical) used in section headings"
      pattern: "getPatientLabel"
---

<objective>
Update Film/TV cert profile ordering, add mobile terminology helper functions, and apply 'Cast & Crew' / 'Set' / 'Production' terminology across all worker and treatment screens (FILM-02, FILM-03). Also verify F2508 dispatch routing is unchanged for Film/TV (FILM-04).

Purpose: A Film/TV medic sees production-appropriate labels throughout the app. The cert profile surfaces the most relevant Film/TV certifications first. RIDDOR auto-flagging and F2508 generation continue to work unchanged â€” no code modifications needed for Film/TV RIDDOR.

Output: Updated cert ordering in both cert files; terminology overrides applied to 7 screens; getLocationLabel/getEventLabel helpers added to vertical-outcome-labels.ts.
</objective>

<execution_context>
@/Users/sabineresoagli/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sabineresoagli/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-film-tv-production-vertical/21-RESEARCH.md
@.planning/phases/21-film-tv-production-vertical/21-01-SUMMARY.md
@services/taxonomy/certification-types.ts
@web/types/certification.types.ts
@services/taxonomy/vertical-outcome-labels.ts
@app/(tabs)/_layout.tsx
@app/(tabs)/workers.tsx
@app/worker/new.tsx
@app/worker/quick-add.tsx
@app/worker/[id].tsx
@app/treatment/[id].tsx
@app/treatment/templates.tsx
@web/lib/pdf/incident-report-dispatcher.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update tv_film cert ordering in both cert files and add mobile terminology helpers</name>
  <files>
    services/taxonomy/certification-types.ts
    web/types/certification.types.ts
    services/taxonomy/vertical-outcome-labels.ts
  </files>
  <action>
**File 1: `services/taxonomy/certification-types.ts`**

Replace the current `tv_film` entry in `VERTICAL_CERT_TYPES` (line 129):

Current:
```typescript
tv_film: ['FREC 3', 'FREC 4', 'PHEC', 'HCPC Paramedic', 'CSCS', 'IPAF', 'ALS Provider', 'PHTLS'],
```

Replace with (HCPC Paramedic first, then ScreenSkills, then FREC 4 / EFR at top; remove CSCS and IPAF â€” construction site access cards are not relevant to film/TV; they remain in the full `CERT_TYPES` list, just deprioritised):
```typescript
tv_film: [
  'HCPC Paramedic',
  'ScreenSkills Production Safety Passport',
  'FREC 4',
  'EFR',
  'PHEC',
  'PHTLS',
  'ALS Provider',
  'ATLS',
  'FREC 3',
],
```

**File 2: `web/types/certification.types.ts`**

Replace the current `tv_film` entry in `VERTICAL_CERT_TYPES` (around line 158-162):

Current:
```typescript
tv_film: [
  'FREC 3', 'FREC 4', 'PHEC', 'HCPC Paramedic',
  'CSCS', 'IPAF',
  'ALS Provider', 'PHTLS',
],
```

Replace with (matching mobile ordering exactly):
```typescript
tv_film: [
  'HCPC Paramedic',
  'ScreenSkills Production Safety Passport',
  'FREC 4',
  'EFR',
  'PHEC',
  'PHTLS',
  'ALS Provider',
  'ATLS',
  'FREC 3',
],
```

**File 3: `services/taxonomy/vertical-outcome-labels.ts`**

Add two new exported helper functions at the bottom of the file (after the existing `getPatientLabel` function). These mirror the pattern established in `web/lib/org-labels.ts` for `locationTerm` and `eventTerm`:

```typescript
/**
 * Returns the location noun for the vertical â€” e.g. "Set" for Film/TV, "Site" for construction.
 * Used in screens that show location context: treatment detail, induction headers.
 */
export function getLocationLabel(verticalId: string | null | undefined): string {
  const labels: Partial<Record<TreatmentVerticalId, string>> = {
    construction:      'Site',
    tv_film:           'Set',
    motorsport:        'Circuit',
    festivals:         'Venue',
    sporting_events:   'Venue',
    fairs_shows:       'Showground',
    corporate:         'Venue',
    private_events:    'Venue',
    education:         'School / Campus',
    outdoor_adventure: 'Location',
    general:           'Site',
  };

  return labels[verticalId as TreatmentVerticalId] ?? 'Site';
}

/**
 * Returns the event/booking noun for the vertical â€” e.g. "Production" for Film/TV, "Client" for construction.
 * Used in screens that show the client/org context.
 */
export function getEventLabel(verticalId: string | null | undefined): string {
  const labels: Partial<Record<TreatmentVerticalId, string>> = {
    construction:      'Client',
    tv_film:           'Production',
    motorsport:        'Event',
    festivals:         'Festival',
    sporting_events:   'Event',
    fairs_shows:       'Show',
    corporate:         'Client',
    private_events:    'Event',
    education:         'School',
    outdoor_adventure: 'Activity',
    general:           'Client',
  };

  return labels[verticalId as TreatmentVerticalId] ?? 'Client';
}
```

**Critical constraints:**
- `'ScreenSkills Production Safety Passport'` and `'EFR'` must exist in `CERT_TYPES` array (added in Plan 21-01) before they can appear in `VERTICAL_CERT_TYPES.tv_film` â€” if Plan 21-01 has not run, TypeScript will error. This plan depends on 21-01.
- Do NOT remove `'CSCS'` or `'IPAF'` from the `CERT_TYPES` master array â€” only remove them from the `tv_film` ordering. Other verticals still reference them.
- The `getLocationLabel` and `getEventLabel` functions must use the same `TreatmentVerticalId` type import already present at the top of the file.
  </action>
  <verify>
Run: `cd /Users/sabineresoagli/GitHub/sitemedic && npx tsc --noEmit 2>&1 | grep -E "certification-types|vertical-outcome-labels"` â€” no errors.
Check cert ordering: `grep -A 12 "tv_film:" /Users/sabineresoagli/GitHub/sitemedic/services/taxonomy/certification-types.ts | head -14` â€” must show HCPC Paramedic first, ScreenSkills second, FREC 4 third, EFR fourth; no CSCS or IPAF in tv_film list.
Check helpers: `grep "getLocationLabel\|getEventLabel" /Users/sabineresoagli/GitHub/sitemedic/services/taxonomy/vertical-outcome-labels.ts` â€” must show 2 function exports.
  </verify>
  <done>
- `VERTICAL_CERT_TYPES.tv_film` in `certification-types.ts` starts with `['HCPC Paramedic', 'ScreenSkills Production Safety Passport', 'FREC 4', 'EFR', ...]`
- `VERTICAL_CERT_TYPES.tv_film` in `web/types/certification.types.ts` matches the mobile ordering exactly
- CSCS and IPAF absent from tv_film ordering in both files (still present in master CERT_TYPES array)
- `getLocationLabel` and `getEventLabel` functions exported from `vertical-outcome-labels.ts`
- No TypeScript errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Apply Film/TV terminology to workers tab, layout, worker screens, and treatment screens</name>
  <files>
    app/(tabs)/_layout.tsx
    app/(tabs)/workers.tsx
    app/worker/new.tsx
    app/worker/quick-add.tsx
    app/worker/[id].tsx
    app/treatment/[id].tsx
    app/treatment/templates.tsx
  </files>
  <action>
Apply `getPatientLabel(primaryVertical)` from `vertical-outcome-labels.ts` and `useOrg()` from OrgContext to each screen that shows hard-coded "Worker" strings. The pattern is identical across all files.

---

**File 1: `app/(tabs)/_layout.tsx`**

The tab layout currently uses static strings for the Workers tab. The challenge: Tabs.Screen `options` is an object literal â€” it cannot directly call hooks. The solution is to compute labels at the top of the component and pass them in.

Add imports at top of file:
```typescript
import { useOrg } from '../../src/contexts/OrgContext';
import { getPatientLabel } from '../../services/taxonomy/vertical-outcome-labels';
```

Inside `TabsLayout()` function (after the `const isTablet = useIsTablet();` line), add:
```typescript
const { primaryVertical } = useOrg();
const personPluralLabel = primaryVertical === 'tv_film' ? 'Cast & Crew' : getPatientLabel(primaryVertical) + 's';
const registryLabel = primaryVertical === 'tv_film' ? 'Cast & Crew Registry' : `${getPatientLabel(primaryVertical)} Registry`;
```

Then update the `workers` Tabs.Screen options (around line 94-102) to use computed labels:
```typescript
<Tabs.Screen
  name="workers"
  options={{
    title: personPluralLabel,
    headerTitle: registryLabel,
    tabBarLabel: personPluralLabel,
    tabBarIcon: ({ color }) => (
      <Text style={[styles.iconText, { color }]}>ðŸ‘·</Text>
    ),
  }}
/>
```

---

**File 2: `app/(tabs)/workers.tsx`**

Add imports after existing imports (after the `SwipeableListItem` import):
```typescript
import { useOrg } from '../../src/contexts/OrgContext';
import { getPatientLabel } from '../../services/taxonomy/vertical-outcome-labels';
```

The component is a class-style component with `WorkersList` as inner function and an outer `withObservables` wrapper. Add `useOrg()` inside the `WorkersList` function component (after the `const [searchQuery, setSearchQuery] = useState('')` line):
```typescript
const { primaryVertical } = useOrg();
const personLabel = getPatientLabel(primaryVertical);
const personPluralLabel = primaryVertical === 'tv_film' ? 'Cast & Crew' : `${personLabel}s`;
```

Then update user-facing strings throughout the file:
- `"âž• Add Worker"` button label â†’ `\`âž• Add ${personLabel}\``
- Empty state title `"No Workers Registered"` â†’ `` `No ${personPluralLabel} Registered` ``
- Empty state subtitle `"Add workers during site induction"` â†’ `` `Add ${personPluralLabel.toLowerCase()} during site induction` ``
- Empty state button `"Add Worker"` â†’ `` `Add ${personLabel}` ``

---

**File 3: `app/worker/new.tsx`**

This file has the full induction form. It currently uses the string "Site Induction" and references workers directly. Add `useOrg()` support.

Add imports:
```typescript
import { useOrg } from '../../src/contexts/OrgContext';
import { getPatientLabel } from '../../services/taxonomy/vertical-outcome-labels';
```

Inside the component function, add:
```typescript
const { primaryVertical } = useOrg();
const personLabel = getPatientLabel(primaryVertical);
```

Update user-visible strings:
- Any header text like "Add Worker" or "Worker Induction" â†’ use `personLabel`
- `worker.role = role.trim() || 'Worker'` (inside the DB write callback) â†’ keep as `'Worker'` â€” this is a DATA field default, not a UI label. Do NOT change DB field defaults.
- Section headings like "Worker Information" â†’ `` `${personLabel} Information` ``

Note: `app/worker/new.tsx` uses `react-hook-form`. The component body is where state and context hooks are called â€” add `useOrg()` inside the component function, not at module level.

---

**File 4: `app/worker/quick-add.tsx`**

The visible title is `"Quick Add Worker"` (line 77) and subtitle references "worker". The component receives `initialName`, `onComplete`, `onCancel` props â€” add `useOrg()` inside the function body.

Add imports:
```typescript
import { useOrg } from '../../src/contexts/OrgContext';
import { getPatientLabel } from '../../services/taxonomy/vertical-outcome-labels';
```

Inside `WorkerQuickAdd` function, add:
```typescript
const { primaryVertical } = useOrg();
const personLabel = getPatientLabel(primaryVertical);
```

Update:
- `<Text style={styles.title}>Quick Add Worker</Text>` â†’ `` <Text style={styles.title}>Quick Add {personLabel}</Text> ``
- `<Text style={styles.subtitle}>Add basic details now. Complete full induction later.</Text>` â€” keep as-is (generic enough)
- `worker.role = role.trim() || 'Worker'` inside the DB write â†’ keep `'Worker'` as it is a data default, not UI label

---

**File 5: `app/worker/[id].tsx`**

This screen has `"Worker Information"` as a section title. Add `useOrg()`.

Add imports:
```typescript
import { useOrg } from '../../src/contexts/OrgContext';
import { getPatientLabel } from '../../services/taxonomy/vertical-outcome-labels';
```

Inside the `WorkerProfile` component, add:
```typescript
const { primaryVertical } = useOrg();
const personLabel = getPatientLabel(primaryVertical);
```

Update:
- `<Text style={styles.sectionTitle}>Worker Information</Text>` does not appear in this file â€” the section title is actually absent; check the render output. If there is any user-visible "Worker" label in section headings, update with `personLabel`. If not, the only change needed is the import for consistency and potential future use.

Looking at the file content (line 153): the section heading is `"Certifications"` not "Worker Information". The profile header shows worker name/company/role from data â€” no hard-coded "Worker" text visible in the section headers. Skip section header change for this file if no hard-coded "Worker" heading exists; just verify.

---

**File 6: `app/treatment/[id].tsx`**

Line 233 has: `<Text style={styles.sectionTitle}>Worker Information</Text>` â€” this must change to use `getPatientLabel`.

This screen does not currently import `useOrg`. Add:
```typescript
import { useOrg } from '../../src/contexts/OrgContext';
import { getPatientLabel } from '../../services/taxonomy/vertical-outcome-labels';
```

Inside `TreatmentDetailScreen`, add:
```typescript
const { primaryVertical } = useOrg();
const patientLabel = getPatientLabel(primaryVertical);
```

Update line 233:
```typescript
<Text style={styles.sectionTitle}>{patientLabel} Information</Text>
```

---

**File 7: `app/treatment/templates.tsx`**

Line 329 has: `<Text style={styles.sectionTitle}>1. Select Worker</Text>` and line 333: `placeholder="Search worker by name or company"`.

Add imports:
```typescript
import { useOrg } from '../../src/contexts/OrgContext';
import { getPatientLabel } from '../../services/taxonomy/vertical-outcome-labels';
```

Inside `TreatmentTemplatesScreen`, add:
```typescript
const { primaryVertical } = useOrg();
const personLabel = getPatientLabel(primaryVertical);
```

Update:
- `"1. Select Worker"` â†’ `` `1. Select ${personLabel}` ``
- `placeholder="Search worker by name or company"` â†’ `` placeholder={`Search ${personLabel.toLowerCase()} by name or company`} ``

---

**FILM-04 verification (read-only, no code changes):**

Read `web/lib/pdf/incident-report-dispatcher.ts` and confirm `tv_film` maps to `riddor-f2508-generator` in `FUNCTION_BY_VERTICAL`. Add a comment in the SUMMARY confirming dispatch is unchanged. No code modifications needed.

**Critical constraints:**
- Do NOT change route paths (`/worker/`, `/worker/new`, etc.) â€” these are internal routing IDs
- Do NOT change WatermelonDB model field names or default strings in DB write callbacks
- `getPatientLabel('tv_film')` returns `'Crew member'` â€” use this as the personLabel. For plural, Film/TV uses 'Cast & Crew' (not 'Crew members') per FILM-02 requirement. Handle this with the explicit `primaryVertical === 'tv_film' ? 'Cast & Crew' : ...` pattern shown in File 1 above.
- All `useOrg()` calls must be inside React function component bodies (not at module scope)
  </action>
  <verify>
Check imports across all 7 files: `grep -l "useOrg\|getPatientLabel" /Users/sabineresoagli/GitHub/sitemedic/app/\(tabs\)/workers.tsx /Users/sabineresoagli/GitHub/sitemedic/app/\(tabs\)/_layout.tsx /Users/sabineresoagli/GitHub/sitemedic/app/worker/new.tsx /Users/sabineresoagli/GitHub/sitemedic/app/worker/quick-add.tsx /Users/sabineresoagli/GitHub/sitemedic/app/treatment/[id].tsx /Users/sabineresoagli/GitHub/sitemedic/app/treatment/templates.tsx` â€” must show all 6 files.
TypeScript: `cd /Users/sabineresoagli/GitHub/sitemedic && npx tsc --noEmit 2>&1 | grep -E "workers|_layout|worker/|treatment/\[id\]|templates" | head -20` â€” no errors.
Dispatch verify: `grep "tv_film" /Users/sabineresoagli/GitHub/sitemedic/web/lib/pdf/incident-report-dispatcher.ts` â€” must show `tv_film` mapping to `riddor-f2508-generator`.
  </verify>
  <done>
- `app/(tabs)/_layout.tsx`: Workers tab shows `personPluralLabel` for tabBarLabel and `registryLabel` for headerTitle, computed from `useOrg().primaryVertical`
- `app/(tabs)/workers.tsx`: "Add Worker" button, empty state, and search placeholder all use `personLabel` / `personPluralLabel` from `getPatientLabel(primaryVertical)`
- `app/worker/new.tsx`: Section headings use `personLabel`; DB field defaults unchanged
- `app/worker/quick-add.tsx`: Title uses `personLabel`
- `app/treatment/[id].tsx`: "Worker Information" section heading uses `patientLabel`
- `app/treatment/templates.tsx`: "1. Select Worker" and search placeholder use `personLabel`
- `web/lib/pdf/incident-report-dispatcher.ts` confirmed unchanged â€” `tv_film` routes to `riddor-f2508-generator` (FILM-04 satisfied with no code changes)
- No TypeScript errors across all modified files
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `grep -n "HCPC Paramedic\|ScreenSkills\|EFR" /Users/sabineresoagli/GitHub/sitemedic/services/taxonomy/certification-types.ts | grep "tv_film" -A 10` â€” confirm ordering: HCPC Paramedic first in tv_film list
2. `grep "tv_film" /Users/sabineresoagli/GitHub/sitemedic/web/lib/pdf/incident-report-dispatcher.ts` â€” confirms `riddor-f2508-generator` mapping (FILM-04)
3. `grep -rn "Cast & Crew\|getPatientLabel\|primaryVertical" /Users/sabineresoagli/GitHub/sitemedic/app/\(tabs\)/` â€” shows terminology wiring in tab layout and workers tab
4. `grep "getLocationLabel\|getEventLabel" /Users/sabineresoagli/GitHub/sitemedic/services/taxonomy/vertical-outcome-labels.ts` â€” confirms 2 new helper exports
5. `cd /Users/sabineresoagli/GitHub/sitemedic && npx tsc --noEmit 2>&1 | head -30` â€” no new TypeScript errors from Plan 21-02
</verification>

<success_criteria>
FILM-01: Film/TV conditional section is in treatment/new.tsx with 4 fields wired to verticalExtraFields (confirmed in Plan 21-01 SUMMARY)
FILM-02: "Cast & Crew" replaces "Workers"/"Worker" in tab bar, header, button labels, search placeholders, and section headings across all 7 screens â€” verified by grep for hard-coded "Worker" strings remaining in user-facing UI (internal model defaults excluded)
FILM-03: tv_film cert ordering in both cert files starts with HCPC Paramedic, ScreenSkills Production Safety Passport, FREC 4, EFR â€” CSCS and IPAF removed from tv_film ordering
FILM-04: `web/lib/pdf/incident-report-dispatcher.ts` confirmed unchanged â€” tv_film routes to riddor-f2508-generator (no code modification needed, existing routing satisfies the requirement)
No TypeScript errors introduced across Phase 21
</success_criteria>

<output>
After completion, create `.planning/phases/21-film-tv-production-vertical/21-02-SUMMARY.md`

Include in SUMMARY:
- Confirmation of FILM-04: incident-report-dispatcher.ts maps tv_film to riddor-f2508-generator; no code changes needed; RIDDOR pipeline unchanged
- List of all files updated with terminology changes
- Updated cert ordering for tv_film vertical
</output>
