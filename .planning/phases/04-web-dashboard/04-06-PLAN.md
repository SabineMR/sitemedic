---
phase: 04-web-dashboard
plan: 06
type: execute
wave: 4
depends_on: ["04-02", "04-03", "04-04", "04-05"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Site manager sees traffic-light compliance score on overview page"
    - "Site manager can filter treatment log by date range, severity, injury type, worker, outcome"
    - "Site manager can click into any treatment for full detail view including photos"
    - "Site manager can view near-miss log with category, severity, date filters"
    - "Site manager can search worker registry by company, role, certification status"
    - "Dashboard updates via 60-second polling"
    - "Site manager can export treatment log as CSV or PDF"
    - "Site manager can export worker registry as CSV"
    - "Dashboard is responsive on desktop and tablet"
  artifacts: []
  key_links: []
---

<objective>
Verify the complete Phase 4 Web Dashboard by running the development server and testing all features end-to-end: auth flow, compliance score, treatment log with filters, treatment detail with photos, near-miss log, worker registry, data export, responsive layout, and 60-second polling.

Purpose: Human verification ensures the dashboard actually works as expected for site managers -- automated builds pass but UI correctness and data display require visual confirmation.

Output: Verified dashboard ready for production use.
</objective>

<execution_context>
@/Users/sabineresoagli/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sabineresoagli/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/04-web-dashboard/04-01-SUMMARY.md
@.planning/phases/04-web-dashboard/04-02-SUMMARY.md
@.planning/phases/04-web-dashboard/04-03-SUMMARY.md
@.planning/phases/04-web-dashboard/04-04-SUMMARY.md
@.planning/phases/04-web-dashboard/04-05-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run build verification and fix any compilation issues</name>
  <files></files>
  <action>
1. Run full build: `cd web && pnpm build`
2. Fix any TypeScript errors or build failures
3. Run `cd web && pnpm dev` to start development server on port 30500
4. Verify all routes are accessible:
   - http://localhost:30500/login (login page)
   - http://localhost:30500/ (overview/compliance score)
   - http://localhost:30500/treatments (treatment log)
   - http://localhost:30500/near-misses (near-miss log)
   - http://localhost:30500/workers (worker registry)
5. Check browser console for runtime errors
6. Test that unauthenticated access redirects to /login
  </action>
  <verify>
- `pnpm build` completes without errors
- Dev server starts on port 30500
- All 5 routes are accessible
- No console errors in browser
  </verify>
  <done>Build passes, dev server runs, all routes accessible without runtime errors.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 4 Web Dashboard with:
1. Auth flow (login page with email/password, middleware route protection)
2. Dashboard layout (responsive sidebar with 4 navigation links)
3. Overview page (traffic-light compliance score, 4 weekly stat cards)
4. Treatment log (sortable/filterable table with date, severity, worker, outcome filters)
5. Treatment detail view (all fields including photos from Supabase Storage)
6. Near-miss log (filterable by category, severity, date)
7. Worker registry (searchable by company, role, cert status)
8. Export: Treatment CSV, Treatment PDF, Worker CSV
9. 60-second polling on all data pages
10. Responsive design (desktop sidebar, mobile hamburger, tablet support)
  </what-built>
  <how-to-verify>
1. Open http://localhost:30500 in browser
2. Verify redirect to /login when not authenticated
3. Log in with test credentials
4. Check overview page:
   - Traffic-light compliance indicator visible (red/amber/green circle)
   - Compliance breakdown shows 4 factors
   - 4 stat cards show weekly numbers
5. Navigate to Treatments tab:
   - Table displays with columns (Date, Worker, Injury Type, Severity, Outcome, RIDDOR)
   - Test date range filter
   - Test severity dropdown filter
   - Test worker name search
   - Click a treatment row to see detail view
   - Verify photos display (if any exist)
   - Click Export > CSV and verify download
   - Click Export > PDF and verify download
6. Navigate to Near-Misses tab:
   - Table displays with columns (Date, Category, Severity, Description, Reported By, Location)
   - Test category filter
   - Test severity filter
7. Navigate to Workers tab:
   - Table displays with columns (Name, Company, Role, Phone, Emergency Contact, Consent, Cert Status, Added)
   - Test company search
   - Test global search
   - Click Export > CSV and verify download
8. Test responsive:
   - Resize browser to tablet width (768px) - sidebar should collapse
   - Click hamburger menu - sidebar opens
   - Tables scroll horizontally on narrow viewport
9. Wait 60+ seconds and verify data refreshes automatically (check Network tab for polling requests)
  </how-to-verify>
  <resume-signal>Type "approved" to complete Phase 4, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
All Phase 4 success criteria verified:
1. Traffic-light compliance score (DASH-01, DASH-02)
2. Weekly stats (DASH-03)
3. Treatment log with filters (DASH-04)
4. Treatment detail with photos (DASH-05)
5. Near-miss log with filters (DASH-06)
6. Worker registry with cert indicators (DASH-07)
7. Worker search (DASH-08)
8. 60-second polling (DASH-09)
9. Responsive design (DASH-10)
10. Treatment CSV export (EXPORT-01)
11. Treatment PDF export (EXPORT-02)
12. Worker CSV export (EXPORT-03)
</verification>

<success_criteria>
- Human has verified all 13 requirements (DASH-01 through DASH-10, EXPORT-01 through EXPORT-03)
- No blocking issues found
- Dashboard is ready for production use
</success_criteria>

<output>
After completion, create `.planning/phases/04-web-dashboard/04-06-SUMMARY.md`
</output>
