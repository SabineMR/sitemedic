---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app.json
  - package.json
  - tsconfig.json
  - babel.config.js
  - .env
  - .env.example
  - .gitignore
  - src/lib/supabase.ts
  - src/types/supabase.ts
  - src/types/env.d.ts
  - App.tsx
autonomous: true

must_haves:
  truths:
    - "Expo project builds and runs on iOS simulator without errors"
    - "Supabase client connects to UK-hosted project (eu-west-2)"
    - "All core dependencies install without conflicts"
    - "TypeScript compilation passes with strict mode"
  artifacts:
    - path: "app.json"
      provides: "Expo app configuration with required plugins"
      contains: "expo-secure-store"
    - path: "src/lib/supabase.ts"
      provides: "Supabase client with AsyncStorage session persistence"
      exports: ["supabase"]
    - path: ".env.example"
      provides: "Environment variable template"
      contains: "EXPO_PUBLIC_SUPABASE_URL"
  key_links:
    - from: "src/lib/supabase.ts"
      to: "@supabase/supabase-js"
      via: "createClient with AsyncStorage adapter"
      pattern: "createClient.*storage.*AsyncStorage"
    - from: "app.json"
      to: "expo-build-properties"
      via: "plugins array"
      pattern: "expo-build-properties"
---

<objective>
Scaffold the Expo React Native project with all Phase 1 dependencies installed and the Supabase client initialized for UK-hosted backend connectivity.

Purpose: Every other plan depends on this project structure existing. This establishes the monorepo layout, TypeScript configuration, and core library initialization that all subsequent plans build on.
Output: A runnable Expo iOS app with Supabase client configured for eu-west-2 (London) region.
</objective>

<execution_context>
@/Users/sabineresoagli/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sabineresoagli/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Expo project and install all Phase 1 dependencies</name>
  <files>
    app.json
    package.json
    tsconfig.json
    babel.config.js
    .gitignore
    App.tsx
  </files>
  <action>
    Create a new Expo project using `npx create-expo-app@latest sitemedic-app --template blank-typescript` in the repo root (or initialize in-place if preferred).

    After scaffolding, install ALL Phase 1 dependencies in one batch:

    Core:
    - `npx expo install expo-secure-store expo-local-authentication expo-crypto @react-native-async-storage/async-storage @react-native-community/netinfo`
    - `npm install @nozbe/watermelondb @supabase/supabase-js`

    WatermelonDB native config:
    - `npx expo install expo-build-properties`
    - Add to app.json plugins: `["expo-build-properties", {"ios": {"extraPods": []}, "android": {"packagingOptions": {"pickFirst": ["**/libcrypto.so", "**/libssl.so"]}}}]`

    Update app.json:
    - Set `name` to "SiteMedic"
    - Set `slug` to "sitemedic"
    - Set `scheme` to "sitemedic"
    - Set `ios.bundleIdentifier` to "com.sitemedic.app"
    - Add plugins: expo-secure-store, expo-local-authentication (with faceIDPermission string: "SiteMedic uses Face ID for quick secure access"), expo-build-properties

    Update tsconfig.json:
    - Enable strict mode
    - Set baseUrl to "."
    - Add path alias: "@/*" -> "src/*"
    - Add "experimentalDecorators": true (required by WatermelonDB)

    Update .gitignore to include:
    - .env
    - node_modules/
    - ios/
    - android/
    - .expo/

    Create a minimal App.tsx that renders a "SiteMedic" text element (placeholder).
  </action>
  <verify>
    Run `npx expo start --ios` (or `npx expo prebuild --platform ios && npx expo run:ios`) and confirm app launches in iOS simulator showing "SiteMedic" text. Run `npx tsc --noEmit` to verify TypeScript compilation passes.
  </verify>
  <done>
    Expo project scaffolded with all Phase 1 dependencies installed. TypeScript strict mode enabled with decorators support. App builds and runs on iOS simulator.
  </done>
</task>

<task type="auto">
  <name>Task 2: Initialize Supabase client with UK region configuration</name>
  <files>
    .env
    .env.example
    src/lib/supabase.ts
    src/types/supabase.ts
    src/types/env.d.ts
  </files>
  <action>
    Create `.env.example` with placeholder values:
    ```
    EXPO_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
    EXPO_PUBLIC_SUPABASE_ANON_KEY=your-anon-key-here
    ```

    Create `.env` as a copy of `.env.example` (user will fill in real values later).

    Create `src/types/env.d.ts` declaring the environment variable types for TypeScript:
    ```typescript
    declare module '@env' {
      export const EXPO_PUBLIC_SUPABASE_URL: string
      export const EXPO_PUBLIC_SUPABASE_ANON_KEY: string
    }
    ```

    Create `src/lib/supabase.ts`:
    - Import `createClient` from `@supabase/supabase-js`
    - Import `AsyncStorage` from `@react-native-async-storage/async-storage`
    - Read URL and anon key from `process.env.EXPO_PUBLIC_SUPABASE_URL` and `process.env.EXPO_PUBLIC_SUPABASE_ANON_KEY`
    - Call `createClient` with auth config:
      - `storage: AsyncStorage`
      - `autoRefreshToken: true`
      - `persistSession: true`
      - `detectSessionInUrl: false` (CRITICAL: mobile apps must NOT use URL-based auth detection)
    - Export `supabase` client instance
    - Add comment: "// GDPR: Supabase project MUST be in eu-west-2 (London) region"

    Create `src/types/supabase.ts` with placeholder Database type:
    ```typescript
    export type Database = {
      public: {
        Tables: {}
        Views: {}
        Functions: {}
      }
    }
    ```
    This will be generated from Supabase schema later. For now it provides the type structure.

    IMPORTANT: Use `process.env.EXPO_PUBLIC_*` pattern (Expo's built-in env var support), NOT a dotenv library. Expo automatically loads EXPO_PUBLIC_ prefixed vars.
  </action>
  <verify>
    Run `npx tsc --noEmit` to verify no TypeScript errors. Verify `src/lib/supabase.ts` exports a `supabase` client. Verify `.env` is in `.gitignore`.
  </verify>
  <done>
    Supabase client initialized with AsyncStorage persistence, detectSessionInUrl disabled for mobile, and environment variables templated. TypeScript types scaffolded for future schema generation.
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with zero errors
- `npx expo start` launches without dependency resolution errors
- `package.json` contains all 7 core dependencies: @supabase/supabase-js, @nozbe/watermelondb, expo-secure-store, expo-local-authentication, expo-crypto, @react-native-async-storage/async-storage, @react-native-community/netinfo
- `src/lib/supabase.ts` exists and exports supabase client
- `.env` is gitignored, `.env.example` is committed
</verification>

<success_criteria>
- Expo app builds and runs on iOS simulator
- All Phase 1 npm dependencies installed without conflicts
- Supabase client properly configured with AsyncStorage and mobile-safe settings
- TypeScript strict mode + decorators enabled
- Project structure matches research-recommended layout (src/lib/, src/types/, src/database/, src/services/)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
