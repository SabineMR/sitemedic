---
phase: 13-ux-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - web/app/(dashboard)/treatments/loading.tsx
  - web/app/(dashboard)/workers/loading.tsx
  - web/app/platform/organizations/page.tsx
  - web/app/admin/command-center/page.tsx
autonomous: true

must_haves:
  truths:
    - "Treatments page shows 6 skeleton rows while server data fetches (no layout shift)"
    - "Workers page shows 6 skeleton rows while server data fetches (no layout shift)"
    - "Organizations page shows 4 skeleton cards in 2-column grid while data loads"
    - "Command center shows skeleton layout (alert sidebar + map area) while Leaflet loads"
  artifacts:
    - path: "web/app/(dashboard)/treatments/loading.tsx"
      provides: "Next.js App Router loading state for treatments server component"
      contains: "Skeleton"
    - path: "web/app/(dashboard)/workers/loading.tsx"
      provides: "Next.js App Router loading state for workers server component"
      contains: "Skeleton"
    - path: "web/app/platform/organizations/page.tsx"
      provides: "Skeleton card grid replacing 'Loading organizations...' text"
      contains: "Skeleton"
    - path: "web/app/admin/command-center/page.tsx"
      provides: "Skeleton layout replacing 'Loading command center...' text in dynamic() loading prop"
      contains: "Skeleton"
  key_links:
    - from: "web/app/(dashboard)/treatments/loading.tsx"
      to: "web/components/ui/skeleton.tsx"
      via: "import { Skeleton } from '@/components/ui/skeleton'"
      pattern: "import.*Skeleton.*from.*@/components/ui/skeleton"
    - from: "web/app/(dashboard)/workers/loading.tsx"
      to: "web/components/ui/skeleton.tsx"
      via: "import { Skeleton } from '@/components/ui/skeleton'"
      pattern: "import.*Skeleton.*from.*@/components/ui/skeleton"
---

<objective>
Add skeleton loading states to four data-heavy pages: treatments, workers, organizations, and command center.

Purpose: Replace plain "Loading..." text with shape-matching skeleton placeholders that prevent layout shift and improve perceived performance. The Skeleton component already exists at `@/components/ui/skeleton.tsx`.
Output: Two new `loading.tsx` files (Next.js App Router convention for server components) and two modified pages (client components with inline skeleton replacement).
</objective>

<execution_context>
@/Users/sabineresoagli/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sabineresoagli/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-ux-polish/13-RESEARCH.md

Key existing files:
@web/components/ui/skeleton.tsx — Skeleton component: `animate-pulse rounded-md bg-primary/10`
@web/app/(dashboard)/treatments/page.tsx — Async server component, no loading state (needs loading.tsx sibling)
@web/app/(dashboard)/workers/page.tsx — Async server component, no loading state (needs loading.tsx sibling)
@web/app/platform/organizations/page.tsx — Client component with `if (loading) return "Loading organizations..."` at line 72
@web/app/admin/command-center/page.tsx — dynamic() with `loading: () => "Loading command center..."` at line 22
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create loading.tsx files for treatments and workers pages</name>
  <files>
    web/app/(dashboard)/treatments/loading.tsx
    web/app/(dashboard)/workers/loading.tsx
  </files>
  <action>
    Create `web/app/(dashboard)/treatments/loading.tsx`:
    - Import `Skeleton` from `@/components/ui/skeleton`
    - Export default function `TreatmentsLoading`
    - Render a skeleton that matches the shape of the treatments page:
      - Page title skeleton: `h-9 w-48 mb-2` + subtitle `h-4 w-32`
      - Filter row: 3 skeletons in a flex row (`h-10 w-48`, `h-10 w-36`, `h-10 w-36`)
      - Table header row: 7 skeleton cells in a flex row with `border-b py-3`
      - 6 table body rows: each with 7 `h-4 flex-1` skeleton cells in a flex row with `py-3 border-b`
    - Use `space-y-4` for the outer container

    Create `web/app/(dashboard)/workers/loading.tsx`:
    - Same structure as treatments but with 5 columns (Name, Company, Role, Site, Cert Status)
    - Page title: `h-9 w-48 mb-2` + subtitle `h-4 w-40`
    - Filter row: 2 skeletons (`h-10 w-64`, `h-10 w-36`)
    - Table header: 5 skeleton cells
    - 6 table body rows: each with 5 `h-4 flex-1` cells

    IMPORTANT: These are `loading.tsx` files — Next.js App Router shows them automatically during server component fetch. Do NOT modify the page.tsx files.
  </action>
  <verify>
    - `ls web/app/(dashboard)/treatments/loading.tsx` confirms file exists
    - `ls web/app/(dashboard)/workers/loading.tsx` confirms file exists
    - `grep -r "Skeleton" web/app/(dashboard)/treatments/loading.tsx` shows Skeleton import
    - `grep -r "Skeleton" web/app/(dashboard)/workers/loading.tsx` shows Skeleton import
    - `pnpm build` completes without errors (run from /web directory)
  </verify>
  <done>
    Both loading.tsx files exist, import Skeleton from @/components/ui/skeleton, and render shape-matching skeleton layouts with 6 rows each. Build passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Replace loading text with skeletons in organizations and command center pages</name>
  <files>
    web/app/platform/organizations/page.tsx
    web/app/admin/command-center/page.tsx
  </files>
  <action>
    Modify `web/app/platform/organizations/page.tsx`:
    - Add `import { Skeleton } from '@/components/ui/skeleton'` at top
    - Replace the `if (loading)` block (lines 72-78) which currently returns `<div className="flex items-center justify-center h-screen"><div className="text-white text-lg">Loading organizations...</div></div>` with a skeleton layout that matches the page shape:
      - Outer div with `className="p-8"`
      - Header row: flex between — left side has title skeleton `h-9 w-48` + subtitle `h-4 w-64`, right side has button skeleton `h-11 w-36 rounded-xl`
      - Search bar skeleton: `h-12 w-full mb-6 rounded-xl`
      - Grid `grid-cols-1 lg:grid-cols-2 gap-6` with 4 card skeletons, each card:
        - `bg-purple-800/30 border border-purple-700/50 rounded-2xl p-6 space-y-4`
        - Header: flex with icon skeleton `w-12 h-12 rounded-xl` + name skeleton `h-5 w-40` + slug `h-3 w-24`
        - Metrics: 3-col grid with `h-10 rounded` skeletons
        - Footer: `h-3 w-48 mt-2` skeleton

    Modify `web/app/admin/command-center/page.tsx`:
    - Add `import { Skeleton } from '@/components/ui/skeleton'` at top
    - Replace the `loading` prop inside `dynamic()` (lines 22-26) which currently renders `<div className="flex items-center justify-center h-screen bg-gray-900"><div className="text-white text-xl">Loading command center...</div></div>` with a skeleton matching the two-panel layout:
      - Outer: `min-h-screen bg-gray-900 text-white`
      - Header skeleton: `bg-gray-800 border-b border-gray-700 px-6 py-4` with title `h-8 w-64 bg-gray-700` + 3 button skeletons `h-10 w-28 bg-gray-700 rounded-lg`
      - Body: `flex h-[calc(100vh-80px)]`
        - Left alert panel: `w-96 border-r border-gray-700 p-4 space-y-3` with 5 alert card skeletons (`h-20 bg-gray-800 rounded-lg`)
        - Right map area: `flex-1 bg-gray-800 animate-pulse` (large area placeholder)
  </action>
  <verify>
    - `grep "Skeleton" web/app/platform/organizations/page.tsx` shows Skeleton usage
    - `grep "Skeleton" web/app/admin/command-center/page.tsx` shows Skeleton usage
    - `grep -c "Loading organizations" web/app/platform/organizations/page.tsx` returns 0 (old text removed)
    - `grep -c "Loading command center" web/app/admin/command-center/page.tsx` returns 0 (old text removed)
    - `pnpm build` completes without errors
  </verify>
  <done>
    Organizations page shows 4 skeleton cards in 2-column grid during loading (no "Loading organizations..." text). Command center shows skeleton header + alert sidebar + map area during dynamic import (no "Loading command center..." text). Build passes.
  </done>
</task>

</tasks>

<verification>
- All four pages have skeleton loading states (no plain text "Loading...")
- `pnpm build` passes without errors
- Skeleton imports all reference `@/components/ui/skeleton`
- No layout shift: skeleton shapes match the actual content dimensions
</verification>

<success_criteria>
1. `web/app/(dashboard)/treatments/loading.tsx` exists with 6-row table skeleton
2. `web/app/(dashboard)/workers/loading.tsx` exists with 6-row table skeleton
3. Organizations page renders 4 skeleton cards instead of "Loading organizations..." text
4. Command center renders skeleton layout instead of "Loading command center..." text
5. `pnpm build` passes cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/13-ux-polish/13-01-SUMMARY.md`
</output>
