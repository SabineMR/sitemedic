---
phase: 34.1-self-procured-jobs
plan: 03
subsystem: ui
tags: [react, nextjs, supabase, dashboard, filtering]

# Dependency graph
requires:
  - phase: 34.1-01
    provides: "Direct jobs data layer (marketplace_events source='direct', direct_clients, types.ts)"
provides:
  - "Combined jobs dashboard page at /dashboard/jobs/combined"
  - "SourceBadge component for marketplace/direct visual distinction"
  - "SourceFilter dropdown component"
  - "Combined API endpoint at /api/direct-jobs/combined"
  - "Marketplace events GET excludes direct jobs via .neq('source', 'direct')"
affects: [34.1-04, 34.1-05]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Combined query pattern: single Supabase query on marketplace_events with source filter"
    - "SourceBadge pattern: colour-coded pill badges for source discrimination"
    - "SourceFilter pattern: controlled dropdown with '' for all, 'marketplace'/'direct' for specific"

key-files:
  created:
    - "web/components/direct-jobs/SourceBadge.tsx"
    - "web/components/direct-jobs/SourceFilter.tsx"
    - "web/app/api/direct-jobs/combined/route.ts"
    - "web/app/(dashboard)/dashboard/jobs/combined/page.tsx"
  modified:
    - "web/app/api/marketplace/events/route.ts"

key-decisions:
  - "Combined API queries marketplace_events for current user without source filter by default (returns all)"
  - "Source filter applied server-side via Supabase .eq() for source param, client-side for status/search"
  - "Marketplace events GET handler now excludes direct jobs to keep My Events pure marketplace"
  - "Direct jobs show agreed_price and client_name; marketplace jobs show '-' for those columns"

patterns-established:
  - "SourceBadge: blue for marketplace, green for direct â€” consistent across all views"
  - "Combined status colour map covers both marketplace (open/closed/awarded) and direct (confirmed/in_progress/completed) statuses"

# Metrics
duration: 9min
completed: 2026-02-20
---

# Phase 34.1 Plan 03: Combined Jobs Dashboard Summary

**Combined jobs dashboard with source badges, source/status/search filters, and marketplace events exclusion filter for direct jobs**

## Performance

- **Duration:** 9 min
- **Started:** 2026-02-20T00:32:29Z
- **Completed:** 2026-02-20T00:41:20Z
- **Tasks:** 2
- **Files modified:** 5

## Accomplishments
- Created SourceBadge component with blue (marketplace) / green (direct) pill badges using SOURCE_LABELS from types.ts
- Created SourceFilter dropdown component with All / Marketplace / Direct options as controlled component
- Built combined API endpoint returning both marketplace and direct jobs with source/status/search/pagination support
- Built combined jobs dashboard page with full filter bar, unified status colours, and detail page routing by source
- Added .neq('source', 'direct') to marketplace events GET handler to keep My Events page pure marketplace

## Task Commits

Each task was committed atomically:

1. **Task 1: Source badge and filter components** - `d33e0c9` (feat)
2. **Task 2: Combined API endpoint and dashboard page** - `8525fe8` (feat)

## Files Created/Modified
- `web/components/direct-jobs/SourceBadge.tsx` - Reusable source badge (marketplace=blue, direct=green)
- `web/components/direct-jobs/SourceFilter.tsx` - Source filter dropdown (All/Marketplace/Direct)
- `web/app/api/direct-jobs/combined/route.ts` - GET endpoint returning unified marketplace + direct jobs
- `web/app/(dashboard)/dashboard/jobs/combined/page.tsx` - Combined jobs page with source badges, filters, table
- `web/app/api/marketplace/events/route.ts` - Added .neq('source', 'direct') to exclude direct jobs from marketplace listing

## Decisions Made
- Combined API queries marketplace_events for current user without source filter by default, returning both marketplace and direct jobs
- Source filter is server-side (Supabase .eq), status and search filters are client-side (useMemo) for responsiveness
- Marketplace events GET now excludes direct jobs via .neq('source', 'direct') so My Events only shows marketplace events
- Direct jobs show agreed_price (formatted GBP) and client_name columns; marketplace jobs show '-' for those
- Combined status colour map includes all statuses from both lifecycles (8 total: draft, open, confirmed, in_progress, completed, closed, cancelled, awarded)

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness
- Combined jobs view ready for Plan 04 (job creation wizard) and Plan 05 (detail/edit pages)
- SourceBadge and SourceFilter components available for reuse in any view that shows mixed-source data
- Dashboard navigation link to /dashboard/jobs/combined can be added when sidebar nav is updated

---
*Phase: 34.1-self-procured-jobs*
*Completed: 2026-02-20*
