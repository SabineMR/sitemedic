# 52-02 Plan — Optional Hardening: Alerts, Network Analytics, Co-Share Enforcement

## Objective

Complete optional integrity hardening by adding scheduled SLA alerts, deeper referral-network analytics, and explicit co-share policy breach automation.

## Requirements Coverage IDs

- `INT-19` — Platform admins receive scheduled alerts for integrity SLA breaches.
- `INT-20` — Referral-network abuse signals cover reciprocal cluster patterns.
- `INT-21` — Co-share fee-policy misuse is detected and scored explicitly.

## Tasks

- [x] **Task 1:** Add optional automation migration
  - `supabase/migrations/169_marketplace_integrity_optional_automation.sql`
  - extends signal taxonomy and notification type support (`integrity_alert`).

- [x] **Task 2:** Add scheduled SLA reporting endpoint
  - `POST /api/cron/integrity-sla-report`
  - sends platform-admin feed alerts when case SLA breaches exist.

- [x] **Task 3:** Add co-share + referral-network signals
  - `CO_SHARE_POLICY_BREACH` detection in score recompute.
  - `REFERRAL_NETWORK_CLUSTER` detection for reciprocal pass-on clusters.

## Verification Strategy

- Grep checks for new signal types and cron endpoint.
- `pnpm --dir web exec tsc --noEmit`
- `pnpm --dir web lint`
- `pnpm --dir web test -- integrity suites`

## Risks + Mitigations

- Alert fatigue: only alert when SLA breaches exist.
- Duplicate signals: recent-window dedupe helper before logging hardening signals.
- Notification compatibility: DB + TS notification type lists updated together.
