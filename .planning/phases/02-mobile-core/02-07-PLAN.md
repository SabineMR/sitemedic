---
phase: 02-mobile-core
plan: 07
type: execute
wave: 2
depends_on: ["02-01", "02-02"]
files_modified:
  - mobile/app/safety/daily-check.tsx
  - mobile/components/safety/DailyChecklistItem.tsx
autonomous: true

must_haves:
  truths:
    - "Medic can complete daily safety checklist (10 items) in under 5 minutes"
    - "Each checklist item has Green/Amber/Red status with optional photo and note"
    - "App prompts medic when opening on workday morning"
    - "Incomplete checklists flag on dashboard for site manager visibility"
  artifacts:
    - path: "mobile/app/safety/daily-check.tsx"
      provides: "Daily safety checklist screen with 10 items"
      min_lines: 80
    - path: "mobile/components/safety/DailyChecklistItem.tsx"
      provides: "Green/Amber/Red checklist item component"
      min_lines: 60
  key_links:
    - from: "mobile/app/safety/daily-check.tsx"
      to: "mobile/services/taxonomy/daily-check-items.ts"
      via: "Import DAILY_CHECK_ITEMS for checklist"
      pattern: "DAILY_CHECK_ITEMS"
    - from: "mobile/components/safety/DailyChecklistItem.tsx"
      to: "mobile/services/photo-processor.ts"
      via: "Photo capture per checklist item"
      pattern: "captureAndCompressPhotos|takePhotoAndCompress"
---

<objective>
Build the daily safety checklist with Green/Amber/Red status pattern, optional photo evidence per item, and completion tracking with daily reset.

Purpose: The daily safety snapshot is a legal compliance requirement. Site managers need assurance that the medic has verified all 10 safety conditions each morning. The Green/Amber/Red pattern is construction industry standard and provides at-a-glance compliance status (DAILY-01 through DAILY-05).
Output: Daily checklist screen and reusable checklist item component.
</objective>

<execution_context>
@/Users/sabineresoagli/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sabineresoagli/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-mobile-core/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DailyChecklistItem component with Green/Amber/Red status</name>
  <files>mobile/components/safety/DailyChecklistItem.tsx</files>
  <action>
  Follow research Pattern 7 (Green/Amber/Red Daily Checklist) exactly.

  **Props interface:**
  ```typescript
  interface DailyChecklistItemProps {
    label: string
    itemId: string
    status: 'green' | 'amber' | 'red' | null
    photoUri: string | null
    note: string
    onStatusChange: (itemId: string, status: 'green' | 'amber' | 'red') => void
    onPhotoChange: (itemId: string, uri: string | null) => void
    onNoteChange: (itemId: string, note: string) => void
  }
  ```

  **Layout:**
  - Item label: fontSize 18, fontWeight '600', marginBottom 12
  - Three status buttons in a row (flex: 1 each, minHeight: 56):
    - Green: "OK" with checkmark, backgroundColor '#D1FAE5', borderColor '#10B981'
    - Amber: "Issue" with warning icon, backgroundColor '#FEF3C7', borderColor '#F59E0B'
    - Red: "Fail" with X icon, backgroundColor '#FEE2E2', borderColor '#EF4444'
  - Selected button: borderWidth 4 (thick border for selected state)
  - Gap of 8px between buttons

  **After status selected (conditional render):**
  - "Add Photo" button (56pt, secondary) -- calls takePhotoAndCompress() from photo-processor
  - If photo taken, show photo preview with "Remove" button
  - Note TextInput: multiline, placeholder "Add note (optional)", minHeight 80, fontSize 16
  - Note and photo are OPTIONAL -- status alone is sufficient for quick completion

  **Amber/Red items:**
  - When amber or red selected, note placeholder changes to "Describe the issue..."
  - Visual emphasis: amber/red items have left border (4px) in their color for list scanning

  **Accessibility:**
  - All buttons: hitSlop 4px
  - Status button text: high contrast on colored backgrounds
  - Use Pressable with pressed opacity feedback
  </action>
  <verify>
  Run `cd mobile && npx tsc --noEmit`.
  Verify 3 status buttons: green, amber, red with correct colors.
  Verify selected state has borderWidth: 4.
  Verify photo and note appear only after status selected.
  Verify minHeight: 56 on status buttons.
  Verify photo uses takePhotoAndCompress from photo-processor.
  </verify>
  <done>DailyChecklistItem component renders Green/Amber/Red status buttons (56pt), optional photo capture, optional note input. Amber/Red items prompt for issue description. All elements accessible with gloves.</done>
</task>

<task type="auto">
  <name>Task 2: Build daily safety checklist screen with completion tracking</name>
  <files>mobile/app/safety/daily-check.tsx</files>
  <action>
  **Daily Checklist Screen:**

  On mount:
  1. Check if today's checklist already exists in WatermelonDB:
     - Query: database.get('safety_checks').query(Q.where('check_date', todayDateString))
     - todayDateString format: YYYY-MM-DD
  2. If exists: load and resume (partially completed)
  3. If not exists: create new SafetyCheck record with:
     - check_date: today's date
     - items: JSON.stringify(DAILY_CHECK_ITEMS.map(item => ({ id: item.id, status: null, photoUri: null, note: '' })))
     - status: 'in_progress'
     - created_at: Date.now()

  **Layout:**
  - Header: "Daily Safety Check" + today's date
  - Progress indicator: "{completed}/{total} items checked" with progress bar
  - ScrollView containing 10 DailyChecklistItem components (DAILY-03)
  - Each item maps to DAILY_CHECK_ITEMS taxonomy:
    1. First aid kit stocked and accessible
    2. AED (defibrillator) functional and accessible
    3. Eyewash station functional
    4. Welfare facilities clean and operational
    5. Site access routes clear and safe
    6. PPE available and in good condition
    7. Housekeeping (site tidy, no trip hazards)
    8. Weather conditions safe for work
    9. Visible hazards identified and controlled
    10. Emergency vehicle access clear

  **Auto-save behavior:**
  - On each status/photo/note change, update the items JSON in SafetyCheck record
  - Debounce 500ms per useAutoSave pattern
  - Show AutoSaveIndicator at top

  **Completion logic:**
  - Track completed count: items with status !== null
  - "Complete Check" button (56pt, primary) enabled only when ALL 10 items have status
  - On complete: set SafetyCheck.status = 'complete', set completed_at = Date.now()
  - After completion, navigate back to safety tab

  **Incomplete checklist handling (DAILY-05):**
  - If medic leaves before completing all 10 items, checklist saves as 'in_progress'
  - On SafetyCheck record: add is_complete: boolean, completed_count: number
  - This data is available for dashboard flagging in Phase 4

  **Daily reset (per research open question #4):**
  - Each day creates a new checklist record (keyed by check_date)
  - Previous day's incomplete checklists remain in history as 'in_progress'
  - No data is deleted -- archived for audit trail
  </action>
  <verify>
  Run `cd mobile && npx tsc --noEmit`.
  Verify 10 checklist items from DAILY_CHECK_ITEMS taxonomy.
  Verify today's check is loaded or created on mount.
  Verify auto-save updates items JSON on every change.
  Verify "Complete Check" requires all 10 items to have status.
  Verify progress indicator shows completed/total count.
  Verify check_date is used as daily key (new checklist per day).
  </verify>
  <done>Daily safety checklist with 10 items, Green/Amber/Red per item, optional photo/note, auto-save, progress tracking, completion gating (all 10 required), daily reset. Designed for <5 minute completion (DAILY-01).</done>
</task>

</tasks>

<verification>
- TypeScript compiles: `cd mobile && npx tsc --noEmit`
- 10 checklist items matching DAILY-03 taxonomy exactly
- Green/Amber/Red status per item (DAILY-02)
- Optional photo and note per item
- Completion requires all 10 items checked
- Daily reset creates new checklist per day
- Auto-save on every field change
</verification>

<success_criteria>
- DAILY-01: 10-item checklist, completable in <5 minutes
- DAILY-02: Green/Amber/Red status + optional photo + note per item
- DAILY-03: All 10 items from taxonomy (first aid kit through emergency vehicle access)
- DAILY-04: Morning prompt (wired in Plan 08 home screen)
- DAILY-05: Incomplete checklists flagged via is_complete field
- All tap targets 56pt minimum
</success_criteria>

<output>
After completion, create `.planning/phases/02-mobile-core/02-07-SUMMARY.md`
</output>
