---
phase: 02-mobile-core
plan: 08
type: execute
wave: 3
depends_on: ["02-03", "02-04", "02-05", "02-06", "02-07"]
files_modified:
  - mobile/app/(tabs)/_layout.tsx
  - mobile/app/(tabs)/index.tsx
  - mobile/app/(tabs)/workers.tsx
  - mobile/app/_layout.tsx
autonomous: false

must_haves:
  truths:
    - "App has 4-tab navigation: Home, Treatments, Workers, Safety"
    - "Home screen shows daily check prompt when checklist not completed"
    - "Near-miss is accessible from home screen in ONE tap"
    - "Worker profile reachable in 2 taps from home"
    - "All workflows work with gloves on (56pt tap targets verified)"
    - "App works 100% offline with no network required"
  artifacts:
    - path: "mobile/app/(tabs)/_layout.tsx"
      provides: "Tab bar navigation with 4 tabs"
      min_lines: 30
    - path: "mobile/app/(tabs)/index.tsx"
      provides: "Home dashboard with quick actions and daily prompt"
      min_lines: 80
    - path: "mobile/app/(tabs)/workers.tsx"
      provides: "Worker registry list tab"
      min_lines: 50
    - path: "mobile/app/_layout.tsx"
      provides: "Root layout with GestureHandlerRootView and BottomSheetModalProvider"
      min_lines: 20
  key_links:
    - from: "mobile/app/(tabs)/index.tsx"
      to: "mobile/app/safety/daily-check.tsx"
      via: "Daily check prompt card links to checklist"
      pattern: "router\\.push.*daily-check"
    - from: "mobile/app/(tabs)/index.tsx"
      to: "mobile/app/safety/near-miss.tsx"
      via: "Near-miss quick action button"
      pattern: "router\\.push.*near-miss"
    - from: "mobile/app/(tabs)/index.tsx"
      to: "mobile/app/treatment/templates.tsx"
      via: "Quick treatment button"
      pattern: "router\\.push.*template"
    - from: "mobile/app/(tabs)/_layout.tsx"
      to: "expo-router"
      via: "Tabs layout component"
      pattern: "Tabs"
---

<objective>
Wire together all Phase 2 features into a cohesive app with tab navigation, home dashboard with quick actions, worker registry tab, and daily check morning prompt.

Purpose: Individual features (treatments, workers, near-misses, daily checks) are built but not connected. This plan creates the app shell, navigation, home dashboard with emergency access and daily prompts, and the workers list tab. It integrates everything into a working offline-first mobile app (UX-01 through UX-08).
Output: Tab navigation, home dashboard, workers list, root layout with required providers.
</objective>

<execution_context>
@/Users/sabineresoagli/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sabineresoagli/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-mobile-core/02-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
@.planning/phases/01-foundation/01-04-SUMMARY.md
@.planning/phases/01-foundation/01-05-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Set up root layout and tab navigation</name>
  <files>mobile/app/_layout.tsx, mobile/app/(tabs)/_layout.tsx</files>
  <action>
  **_layout.tsx (Root Layout):**
  - Wrap entire app in required providers:
    - GestureHandlerRootView (from react-native-gesture-handler, required for bottom sheets)
    - BottomSheetModalProvider (from @gorhom/react-native-bottom-sheet)
    - AuthContext.Provider (from Phase 1, 01-04)
    - SyncContext.Provider (from Phase 1, 01-05)
    - DatabaseProvider for WatermelonDB (from Phase 1, 01-03)
  - Use Expo Router Stack layout for root
  - Configure screens: (tabs) as main, treatment/* as modals, worker/* as modals, safety/* as modals
  - Set StatusBar to dark-content for bright-light readability (UX-02)

  **(tabs)/_layout.tsx (Tab Bar):**
  - 4 tabs using Expo Router Tabs component:
    1. Home (index) - icon: home, label: "Home"
    2. Treatments (treatments) - icon: clipboard/medical, label: "Treatments"
    3. Workers (workers) - icon: people, label: "Workers"
    4. Safety (safety) - icon: shield, label: "Safety"
  - Tab bar styling:
    - Height: 80px (larger than default for gloves-on usability)
    - Icon size: 28px
    - Label fontSize: 14, fontWeight: '600'
    - Active color: #2563EB (high contrast blue)
    - Inactive color: #6B7280
    - Background: #FFFFFF with top border
  - Show sync status indicator in header (from Phase 1, 01-05 SyncStatusIndicator)
  - Show pending count badge on appropriate tab if sync items pending

  Do NOT import Ionicons if not already in the project -- use simple text labels or emoji as icons, or check what icon library is available from Expo SDK 54 (likely @expo/vector-icons).
  </action>
  <verify>
  Run `cd mobile && npx tsc --noEmit`.
  Verify root layout has GestureHandlerRootView wrapper.
  Verify tab layout has 4 tabs: index, treatments, workers, safety.
  Verify tab bar minHeight is 80+ for gloves-on usability.
  Verify active color is high contrast (#2563EB).
  </verify>
  <done>Root layout wraps app in required providers (gesture handler, bottom sheet, auth, sync, database). Tab bar has 4 tabs with 80px height, high contrast colors, and sync status indicator.</done>
</task>

<task type="auto">
  <name>Task 2: Build home dashboard and workers list tab</name>
  <files>mobile/app/(tabs)/index.tsx, mobile/app/(tabs)/workers.tsx</files>
  <action>
  **index.tsx (Home Dashboard):**
  The medic's command center. Shows what needs attention and provides quick access to core workflows.

  **Layout (single scrollable screen):**

  1. Daily Check Prompt Banner (DAILY-04):
     - Query today's SafetyCheck record
     - If no checklist today OR status='in_progress': show amber banner "Daily Safety Check not completed" with "Start Check" button (56pt)
     - If status='complete': show green banner "Daily check complete" with checkmark
     - Banner at very top of screen for immediate visibility

  2. Quick Actions Grid (2x2 grid of large cards):
     - "Quick Treatment" (blue) -- navigates to treatment/templates.tsx
     - "Full Treatment" (blue) -- navigates to treatment/new.tsx
     - "Near-Miss" (red, prominent) -- navigates to safety/near-miss.tsx (NEAR-06: ONE tap from home)
     - "Add Worker" -- navigates to worker/new.tsx
     - Each card: minHeight 100, borderRadius: 12, icon + label, fontSize: 18
     - Cards are large enough for gloves-on tapping

  3. Emergency Access Section (WORK-04):
     - "Emergency Worker Lookup" header
     - Recent workers list (last 5 by most recent treatment date)
     - Each worker row: 56pt height, name + company + last treatment date
     - Tap navigates directly to worker/[id].tsx (2 taps: Home -> Worker = WORK-04 achieved)
     - "View All Workers" link at bottom

  4. Today's Summary Stats:
     - Treatments logged today: count
     - Near-misses reported today: count
     - Workers inducted today: count
     - Query WatermelonDB for today's records (created_at >= today midnight)

  5. Sync Status:
     - Import SyncStatusIndicator from Phase 1 (01-05)
     - Show at bottom: "Synced" / "X items pending" / "Offline"

  **workers.tsx (Workers Registry Tab):**
  - Screen title: "Worker Registry"
  - "Add Worker" button at top (56pt, primary) -- navigates to worker/new.tsx
  - Search bar: filter by name/company/role (debounced 300ms)
  - FlatList of workers sorted alphabetically by name
  - Each list item (56pt min height):
    - Worker name (bold) + Company
    - Role
    - Certification status: StatusBadge showing worst cert status (red if any expired, amber if any expiring <30 days, green if all current)
    - isIncomplete flag: show "Profile Incomplete" amber badge if true
    - Tap navigates to worker/[id].tsx
  - Empty state: "No workers registered. Add workers during site induction." with "Add Worker" button

  **Data loading for both screens:**
  - Use WatermelonDB queries with reactive observation
  - Lazy loading for instant app launch (UX-08)
  </action>
  <verify>
  Run `cd mobile && npx tsc --noEmit`.
  Verify index.tsx has daily check prompt banner.
  Verify index.tsx has 4 quick action cards including "Near-Miss".
  Verify index.tsx has emergency worker lookup section with recent workers.
  Verify workers.tsx has search bar and alphabetical list.
  Verify workers.tsx shows certification status badges.
  Verify all interactive elements have minHeight: 56.
  </verify>
  <done>Home dashboard shows daily check prompt, 4 quick action cards (near-miss in ONE tap), emergency worker lookup (2-tap access), and today's summary stats. Workers tab shows searchable alphabetical list with certification status badges.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Phase 2 Mobile Core app with 4-tab navigation, treatment logging (quick + full mode), worker profiles with search/quick-add, near-miss capture with GPS, daily safety checklist with Green/Amber/Red, and home dashboard with emergency access.</what-built>
  <how-to-verify>
  1. Run the app: `cd mobile && npx expo start` (or development build)
  2. Navigate through all 4 tabs: Home, Treatments, Workers, Safety
  3. Test treatment quick log: Home -> Quick Treatment -> Select worker -> Tap preset -> Confirm (<30s target)
  4. Test full treatment: Treatments tab -> Full Treatment -> Fill all fields -> Capture photo -> Add signature -> Complete
  5. Test near-miss: Home -> Near-Miss (ONE tap) -> Take photo -> Select category -> Set severity -> Report
  6. Test daily check: Home -> "Start Check" banner -> Complete 10 items with Green/Amber/Red -> Submit
  7. Test worker add: Workers tab -> Add Worker -> Fill induction form -> Save
  8. Test emergency access: Home -> Tap recent worker -> View profile + treatment history (2 taps)
  9. Test airplane mode: Turn on airplane mode, repeat all above workflows (100% offline)
  10. Verify all buttons are tappable with gloves on (large 56pt targets visible)
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues with specific screens/workflows.</resume-signal>
</task>

</tasks>

<verification>
- TypeScript compiles: `cd mobile && npx tsc --noEmit`
- 4 tabs visible in tab bar
- Home shows daily check prompt (DAILY-04)
- Near-miss accessible in ONE tap from home (NEAR-06)
- Worker profile reachable in 2 taps (WORK-04)
- All workflows work in airplane mode
- Tab bar 80px height for gloves-on
</verification>

<success_criteria>
- UX-01: All tap targets 56pt minimum (tab bar 80px height)
- UX-02: High contrast colors, no light grey text
- UX-03: Core workflows accessible one-handed (tab bar at bottom)
- UX-04: Familiar patterns, obvious labelling
- UX-05: Quick log <30s, full log <90s (enabled by templates + auto-save)
- UX-06: Near-miss <45s (photo-first + visible categories)
- UX-07: Daily check <5min (10 items, Green/Amber/Red)
- UX-08: App launches instantly (lazy loading)
- NEAR-06: Near-miss ONE tap from home
- WORK-04: Worker profile in 2 taps during emergency
- DAILY-04: Morning prompt on home screen
- 100% offline operation (airplane mode test)
</success_criteria>

<output>
After completion, create `.planning/phases/02-mobile-core/02-08-SUMMARY.md`
</output>
