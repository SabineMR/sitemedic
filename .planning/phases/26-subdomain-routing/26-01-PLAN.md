---
phase: 26
plan: 01
name: Environment Setup & DNS Initiation
wave: 1
depends_on: []
autonomous: false
gap_closure: false
files_modified:
  - web/.env.local.example
  - web/.env.local
---

<objective>
Add `NEXT_PUBLIC_ROOT_DOMAIN` env var to the project configuration and create a checkpoint for Sabine to configure the Vercel wildcard domain and DNS CNAME. The env var is required by the subdomain extraction middleware (26-02). DNS propagation takes up to 72h so this must be initiated early.
</objective>

<must_haves>
- NEXT_PUBLIC_ROOT_DOMAIN env var exists in .env.local.example with documentation
- NEXT_PUBLIC_ROOT_DOMAIN set in .env.local for local development
</must_haves>

<tasks>

<task id="1" name="Add NEXT_PUBLIC_ROOT_DOMAIN to env example" type="code">
Update `web/.env.local.example` to add the new env var with documentation:

```
# Root domain for subdomain routing (Phase 26)
# Production: sitemedic.co.uk — Vercel wildcard *.sitemedic.co.uk resolves subdomains
# Development: localhost:30500 — use tenant.localhost:30500 for local testing
NEXT_PUBLIC_ROOT_DOMAIN=sitemedic.co.uk
```

Add this after the existing `NEXT_PUBLIC_SITE_URL` entry (line ~23) to keep domain-related vars together.
</task>

<task id="2" name="Set NEXT_PUBLIC_ROOT_DOMAIN in local env" type="code">
Add `NEXT_PUBLIC_ROOT_DOMAIN=localhost:30500` to `web/.env.local` for local development.

This value ensures `extractSubdomain()` (Plan 26-02) treats `tenant.localhost:30500` as a subdomain request during local development.
</task>

<task id="3" name="Checkpoint: Configure Vercel wildcard domain and DNS" type="checkpoint:human-verify">
Present Sabine with the Vercel + DNS setup checklist:

**Vercel Configuration:**
1. Go to Vercel Project Settings > Domains
2. Add `*.sitemedic.co.uk` as a wildcard domain
3. Vercel will show a CNAME record to configure

**DNS Configuration (at domain registrar):**
1. Add CNAME record: `*` → `cname.vercel-dns.com` (or the value Vercel shows)
2. DNS propagation takes up to 72 hours

**Vercel Env Vars:**
1. Add `NEXT_PUBLIC_ROOT_DOMAIN=sitemedic.co.uk` in Vercel Project Settings > Environment Variables (Production + Preview)
2. Ensure `SUPABASE_SERVICE_ROLE_KEY` is already set (needed for middleware org lookup)

**Note:** Code development can proceed before DNS propagates. Test locally with `/etc/hosts` entries like `127.0.0.1 apex.localhost`.

Awaiting: "done" when Vercel wildcard domain is added and DNS CNAME is initiated, OR "skip" to continue with code development while DNS propagates.
</task>

</tasks>

<verification>
- [ ] `NEXT_PUBLIC_ROOT_DOMAIN` appears in web/.env.local.example with documentation
- [ ] `NEXT_PUBLIC_ROOT_DOMAIN=localhost:30500` is set in web/.env.local
- [ ] Sabine is informed of Vercel + DNS steps (checkpoint presented)
</verification>
