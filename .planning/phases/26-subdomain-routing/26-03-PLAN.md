---
phase: 26
plan: 03
name: Branded Login Page
wave: 2
depends_on: [26-02]
autonomous: true
gap_closure: false
files_modified:
  - web/app/(auth)/login/page.tsx
  - web/app/(auth)/login/login-form.tsx
  - web/app/(auth)/layout.tsx
---

<objective>
Update the login page to show org branding when accessed via a subdomain. The login page at `apex.sitemedic.co.uk/login` should show the Apex Safety Solutions company name and logo instead of the generic "SiteMedic" branding. Falls back to SiteMedic defaults on the apex domain.

Requirements addressed: ROUTE-04.
</objective>

<must_haves>
- Subdomain login page shows org company name in the card header (not "SiteMedic")
- Subdomain login page shows org logo when logo_path is configured
- Apex domain login page shows "SiteMedic" defaults unchanged
- "Powered by SiteMedic" footer disclosure on subdomain login pages
- No client-side fetch for branding data — all resolved from x-org-* headers via SSR
</must_haves>

<tasks>

<task id="1" name="Extract login form to client component" type="refactor">
Create `web/app/(auth)/login/login-form.tsx` — extract the existing `LoginContent` component from `page.tsx` into this new file.

The new component accepts branding props:

```typescript
'use client';

interface LoginBranding {
  companyName: string;
  logoUrl: string;
  primaryColour: string;
  tagline: string;
  isSubdomain: boolean;
}

interface LoginFormProps {
  branding: LoginBranding;
}

export function LoginForm({ branding }: LoginFormProps) {
  // ... existing LoginContent logic (state, handlers, form) ...
}
```

Key changes inside the component:
- Replace hardcoded `"SiteMedic"` CardTitle with `{branding.companyName}`
- Replace hardcoded `"Site Manager Dashboard"` CardDescription with `{branding.tagline || 'Site Manager Dashboard'}`
- Add org logo display when `branding.logoUrl` is present (above the card title):
  ```tsx
  {branding.logoUrl && (
    <div className="flex justify-center mb-2">
      <img src={branding.logoUrl} alt={branding.companyName} className="h-12 w-auto" />
    </div>
  )}
  ```
- Add "Powered by SiteMedic" footer when `branding.isSubdomain` is true:
  ```tsx
  {branding.isSubdomain && (
    <p className="text-xs text-muted-foreground text-center mt-4">
      Powered by SiteMedic
    </p>
  )}
  ```

Move all imports (useState, useEffect, Suspense, Link, useSearchParams, createClient, UI components, icons, LOGIN_STORAGE_KEY) to the new file.
</task>

<task id="2" name="Convert login page to server component" type="refactor">
Rewrite `web/app/(auth)/login/page.tsx` as a server component that reads x-org-* headers and passes branding to the client form:

```typescript
import { headers } from 'next/headers';
import { Suspense } from 'react';
import { LoginForm } from './login-form';

export default async function LoginPage() {
  const headersList = await headers();

  const branding = {
    companyName: headersList.get('x-org-company-name') || 'SiteMedic',
    logoUrl: headersList.get('x-org-logo-url') || '',
    primaryColour: headersList.get('x-org-primary-colour') || '',
    tagline: headersList.get('x-org-tagline') || 'Site Manager Dashboard',
    isSubdomain: !!headersList.get('x-org-slug'),
  };

  return (
    <Suspense>
      <LoginForm branding={branding} />
    </Suspense>
  );
}
```

Remove `'use client'` directive — this is now a server component. The `LoginForm` client component handles all interactivity.
</task>

<task id="3" name="Update auth layout with optional branding accent" type="code">
Update `web/app/(auth)/layout.tsx` to optionally apply the org's primary colour as a CSS custom property for the accent colour on the login page:

```typescript
import { headers } from 'next/headers';

export default async function AuthLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  const headersList = await headers();
  const primaryColour = headersList.get('x-org-primary-colour') || '';

  return (
    <div
      className="min-h-screen bg-background flex items-center justify-center p-4"
      style={primaryColour ? { '--org-primary': primaryColour } as React.CSSProperties : undefined}
    >
      {children}
    </div>
  );
}
```

This injects the CSS custom property `--org-primary` which Phase 27 (BrandingProvider) will use more broadly. For now, the login page can optionally use it for button accent.
</task>

</tasks>

<verification>
- [ ] Login page at apex domain shows "SiteMedic" title and "Site Manager Dashboard" subtitle (unchanged)
- [ ] Login page at subdomain shows org company name and tagline from x-org-* headers
- [ ] Org logo displays when x-org-logo-url header is present
- [ ] "Powered by SiteMedic" footer shows on subdomain login only
- [ ] No `'use client'` directive on page.tsx — it's a server component
- [ ] Login form still works (magic link send, email confirmation flow, error handling)
- [ ] No client-side fetch for branding data (verify: no API calls in Network tab on login page load)
- [ ] Suspense boundary preserved around LoginForm for useSearchParams
</verification>
