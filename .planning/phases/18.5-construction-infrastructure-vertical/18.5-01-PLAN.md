---
phase: 18.5-construction-infrastructure-vertical
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - services/taxonomy/verticals.ts
autonomous: true

must_haves:
  truths:
    - "A 'construction' entry exists in VERTICAL_CONFIG with riddorApplies: true"
    - "VERTICAL_CONFIG['construction'].label === 'Construction & Infrastructure'"
    - "VERTICAL_CONFIG['construction'].patientTerm === 'Worker'"
    - "VERTICAL_CONFIG['construction'].locationTerm === 'Site'"
    - "VERTICAL_CONFIG['construction'].clientTerm === 'Client'"
    - "VERTICAL_CONFIG['construction'].certOrdering starts with ['CSCS', 'CPCS', 'IPAF', 'Gas Safe']"
    - "VERTICAL_CONFIG['construction'].pdfGenerator === 'riddor-f2508-generator'"
    - "getVerticalConfig('construction') returns the construction entry"
    - "getVerticalConfig('unknown') returns undefined"
    - "No existing taxonomy file has been modified"
  artifacts:
    - path: "services/taxonomy/verticals.ts"
      provides: "Canonical VERTICAL_CONFIG record with VerticalConfig interface"
      exports: ["VerticalConfig", "VERTICAL_CONFIG", "getVerticalConfig"]
      contains: "construction"
  key_links:
    - from: "services/taxonomy/verticals.ts"
      to: "services/taxonomy/certification-types.ts"
      via: "certOrdering field mirrors cert keys from CERT_TYPES — no import needed, strings only"
      pattern: "certOrdering"
    - from: "services/taxonomy/verticals.ts"
      to: "web/lib/pdf/incident-report-dispatcher.ts"
      via: "pdfGenerator field matches FUNCTION_BY_VERTICAL key 'riddor-f2508-generator'"
      pattern: "pdfGenerator"
---

<objective>
Create the canonical vertical config TypeScript file that the multi-vertical system uses as its authoritative source. This is a new file — no equivalent exists today. Construction is the reference entry; Phases 19–22 will add motorsport, festivals, film_tv, and football entries to the same record.

Purpose: Establish a single source of truth for vertical label, RIDDOR applicability, patient/location/client terminology, construction-specific cert priority order, and PDF generator routing — all in one place that Phases 19–22 can follow as a pattern.

Output: `services/taxonomy/verticals.ts` — new file, zero changes to any existing file.
</objective>

<execution_context>
@/Users/sabineresoagli/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sabineresoagli/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18.5-construction-infrastructure-vertical/18.5-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create services/taxonomy/verticals.ts — canonical vertical config (NEW FILE)</name>
  <files>services/taxonomy/verticals.ts</files>
  <action>
    CREATE this file from scratch. It does NOT exist yet — confirm with `ls services/taxonomy/` before writing.

    Write the following content exactly:

    ```typescript
    /**
     * Canonical Vertical Configuration
     *
     * Single source of truth for per-vertical metadata used across the multi-vertical system.
     * Each entry defines the display label, RIDDOR applicability, terminology (patient/location/client),
     * construction-domain cert priority order, and the PDF generator Edge Function name.
     *
     * This file is additive — existing taxonomy files (vertical-compliance.ts,
     * certification-types.ts, vertical-outcome-labels.ts, etc.) are NOT changed.
     * They remain the functional source for their respective concerns.
     *
     * Phase 18.5: construction entry (reference implementation)
     * Phase 19:   motorsport entry
     * Phase 20:   festivals entry
     * Phase 21:   film_tv entry
     * Phase 22:   football entry
     */

    export interface VerticalConfig {
      /** Display label shown in admin UI and booking form */
      label: string;
      /** Whether HSE RIDDOR (2013) applies to the typical patient in this vertical */
      riddorApplies: boolean;
      /** Singular noun for the person being treated (e.g. "Worker", "Attendee") */
      patientTerm: string;
      /** Noun for the work location (e.g. "Site", "Venue", "Circuit / Paddock") */
      locationTerm: string;
      /** Noun for the client / employer / event organiser (e.g. "Client", "Organiser") */
      clientTerm: string;
      /**
       * Ordered list of cert type IDs, most relevant first.
       * IDs must match keys in CERT_TYPES (services/taxonomy/certification-types.ts).
       * This ordering is used in the canonical config for reference by Phases 19–22.
       * The existing getRecommendedCertTypes() in certification-types.ts is the runtime function.
       */
      certOrdering: string[];
      /** Edge Function name that generates the incident report PDF for this vertical */
      pdfGenerator: string;
    }

    /**
     * Canonical vertical configuration record.
     * Key is the vertical ID string stored in org_settings.industry_verticals and
     * treatments.event_vertical.
     */
    export const VERTICAL_CONFIG: Record<string, VerticalConfig> = {
      construction: {
        label: 'Construction & Infrastructure',
        riddorApplies: true,
        patientTerm: 'Worker',
        locationTerm: 'Site',
        clientTerm: 'Client',
        certOrdering: [
          'CSCS',
          'CPCS',
          'IPAF',
          'Gas Safe',
          'First Aid at Work',
          'FREC 3',
          'FREC 4',
          'PHEC',
          'HCPC Paramedic',
          'ALS Provider',
          'PHTLS',
          'PASMA',
        ],
        pdfGenerator: 'riddor-f2508-generator',
      },
      // Phase 19: motorsport entry — GCS form, Motorsport UK PDF, riddorApplies: false
      // Phase 20: festivals entry — Purple Guide PDF, riddorApplies: false
      // Phase 21: film_tv entry — F2508 reused, riddorApplies: true
      // Phase 22: football entry — FA / SGSA PDF, riddorApplies: false
    };

    /**
     * Get the canonical config for a vertical ID.
     * Returns undefined if the vertical is not yet registered in VERTICAL_CONFIG.
     * (Use getVerticalCompliance() from vertical-compliance.ts for RIDDOR/framework details.)
     */
    export function getVerticalConfig(verticalId: string): VerticalConfig | undefined {
      return VERTICAL_CONFIG[verticalId];
    }
    ```

    IMPORTANT: Do NOT touch any of these existing files:
    - services/taxonomy/vertical-compliance.ts
    - services/taxonomy/certification-types.ts
    - services/taxonomy/vertical-outcome-labels.ts
    - services/taxonomy/mechanism-presets.ts
    - web/lib/pdf/incident-report-dispatcher.ts
    - supabase/functions/riddor-detector/index.ts
  </action>
  <verify>
    Run: `npx tsc --noEmit --project tsconfig.json 2>&1 | head -30`
    (or the project's TypeScript check — confirm no type errors in the new file)

    Also verify by reading the file back: the construction entry must be present with all 7 fields populated.

    Check no existing file was modified:
    `git -C /Users/sabineresoagli/GitHub/sitemedic diff --name-only`
    Should show ONLY `services/taxonomy/verticals.ts` as new/modified.
  </verify>
  <done>
    - File exists at services/taxonomy/verticals.ts
    - Exports: VerticalConfig interface, VERTICAL_CONFIG record, getVerticalConfig function
    - VERTICAL_CONFIG['construction'].riddorApplies === true
    - VERTICAL_CONFIG['construction'].patientTerm === 'Worker'
    - VERTICAL_CONFIG['construction'].locationTerm === 'Site'
    - VERTICAL_CONFIG['construction'].clientTerm === 'Client'
    - VERTICAL_CONFIG['construction'].certOrdering[0] === 'CSCS'
    - VERTICAL_CONFIG['construction'].certOrdering[3] === 'Gas Safe'
    - VERTICAL_CONFIG['construction'].pdfGenerator === 'riddor-f2508-generator'
    - getVerticalConfig('construction') returns the entry
    - getVerticalConfig('nonexistent') returns undefined
    - No TypeScript errors
    - No existing taxonomy file modified (git diff shows only the new file)
  </done>
</task>

</tasks>

<verification>
After task completion:
1. `git diff --name-only` — must show only `services/taxonomy/verticals.ts` (new untracked file)
2. TypeScript compilation passes with no errors in the new file
3. Read the file and confirm: construction entry has all 7 fields, certOrdering starts with ['CSCS', 'CPCS', 'IPAF', 'Gas Safe', 'First Aid at Work'], riddorApplies is true
4. Confirm existing files are untouched: `git diff services/taxonomy/` shows nothing for existing files
</verification>

<success_criteria>
- services/taxonomy/verticals.ts created (new file, never existed before)
- VerticalConfig interface exported with 7 fields: label, riddorApplies, patientTerm, locationTerm, clientTerm, certOrdering, pdfGenerator
- VERTICAL_CONFIG record exported with construction as the sole entry
- getVerticalConfig helper exported
- construction entry satisfies CONST-01: riddorApplies: true, label 'Construction & Infrastructure', patientTerm 'Worker', locationTerm 'Site', clientTerm 'Client'
- construction certOrdering satisfies CONST-02 pattern: CSCS, CPCS, IPAF, Gas Safe in the leading positions
- construction pdfGenerator satisfies CONST-03 routing: 'riddor-f2508-generator'
- Zero changes to any pre-existing file
</success_criteria>

<output>
After completion, create `.planning/phases/18.5-construction-infrastructure-vertical/18.5-01-SUMMARY.md`
</output>
