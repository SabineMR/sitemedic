---
phase: 18.5-construction-infrastructure-vertical
plan: 02
subsystem: infra
tags: [riddor, vertical, construction, compliance, pdf-dispatch, cert-types]

# Dependency graph
requires:
  - phase: 18-vertical-infrastructure-riddor-fix
    provides: RIDDOR gate, PDF dispatcher, vertical taxonomy files

provides:
  - Read-only smoke-test confirming construction vertical end-to-end path is intact
  - Verified: NON_RIDDOR_VERTICALS excludes 'construction'
  - Verified: FUNCTION_BY_VERTICAL routes construction to 'riddor-f2508-generator'
  - Verified: VERTICAL_CERT_TYPES.construction contains CSCS, CPCS, IPAF, PASMA, Gas Safe
  - Verified: getVerticalCompliance('construction').riddorApplies === true
  - Verified: getVerticalCompliance('construction').patientIsWorker === true
  - Verified: getVerticalCompliance('construction').primaryFramework === 'RIDDOR'
  - Verified: getPatientLabel('construction') === 'Worker'

affects:
  - phase: 19-motorsport-vertical
  - phase: 22-football-sporting-events
  - phase: 23-compliance-analytics

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Smoke-test plan pattern: read-only verification producing only SUMMARY.md, no code commits"
    - "NON_RIDDOR_VERTICALS deny-list: absent from list means RIDDOR applies — construction intentionally absent"
    - "FUNCTION_BY_VERTICAL routing table: construction -> riddor-f2508-generator (F2508 form)"

key-files:
  created: []
  modified: []

key-decisions:
  - "No code changes required — all construction paths were correctly wired from Phase 18"
  - "Deny-list strategy for RIDDOR gate confirmed: NON_RIDDOR_VERTICALS contains only non-workplace verticals"

patterns-established:
  - "Construction vertical is first-class RIDDOR vertical: absent from NON_RIDDOR_VERTICALS, routes to F2508"
  - "Patient label for construction is 'Worker' — consistent with RIDDOR worker-injury semantics"
  - "Cert ordering for construction leads with FREC 3/4/PHEC then CSCS/CPCS/IPAF/PASMA/Gas Safe"

# Metrics
duration: 1min
completed: 2026-02-18
---

# Phase 18.5 Plan 02: Construction Vertical Smoke Test Summary

**Read-only verification confirming construction vertical's RIDDOR gate, F2508 dispatcher, cert ordering, compliance config, and patient label are all correctly wired — zero regressions found**

## Performance

- **Duration:** 1 min
- **Started:** 2026-02-18T03:42:19Z
- **Completed:** 2026-02-18T03:42:47Z
- **Tasks:** 2/2
- **Files modified:** 0

## Accomplishments

- Confirmed `'construction'` is absent from `NON_RIDDOR_VERTICALS` — RIDDOR detection runs for construction patients
- Confirmed `FUNCTION_BY_VERTICAL['construction'] === 'riddor-f2508-generator'` — correct PDF form dispatched
- Confirmed `VERTICAL_CERT_TYPES.construction` contains all five required certs: CSCS, CPCS, IPAF, PASMA, Gas Safe
- Confirmed `getVerticalCompliance('construction')` returns `riddorApplies: true`, `patientIsWorker: true`, `primaryFramework: 'RIDDOR'`
- Confirmed `getPatientLabel('construction')` returns `'Worker'`

## Task Commits

This plan is read-only — no task code commits. Only a metadata docs commit is produced.

**Plan metadata:** (see final commit hash below)

## Verified Checkpoints (File Paths and Line Numbers)

### CONST-03: RIDDOR Gate + PDF Dispatcher

**File:** `supabase/functions/riddor-detector/index.ts`

- **Line 75:** `const NON_RIDDOR_VERTICALS = ['festivals', 'motorsport', 'sporting_events', 'fairs_shows', 'private_events'];`
- `'construction'` is NOT present in this array. Any treatment with `effectiveVertical === 'construction'` passes through the gate and proceeds to `detectRIDDOR()`.
- Status: **PASS**

**File:** `web/lib/pdf/incident-report-dispatcher.ts`

- **Line 21:** `construction:      'riddor-f2508-generator',`
- `construction` routes to `'riddor-f2508-generator'` (the HSE F2508 RIDDOR Report PDF generator built in Phase 6).
- Status: **PASS**

---

### CONST-02: Cert Ordering

**File:** `services/taxonomy/certification-types.ts`

- **Line 128:** `construction: ['FREC 3', 'FREC 4', 'PHEC', 'HCPC Paramedic', 'CSCS', 'CPCS', 'IPAF', 'PASMA', 'Gas Safe', 'ALS Provider', 'PHTLS'],`
- All five required construction certs present: CSCS (line 33), CPCS (line 34), IPAF (line 35), PASMA (line 36), Gas Safe (line 37).
- `getRecommendedCertTypes('construction')` (line 142-146) returns the construction list first, then the remainder of `CERT_TYPES` — ordering is correct.
- Status: **PASS**

---

### CONST-01: Compliance Config + Patient Label

**File:** `services/taxonomy/vertical-compliance.ts`

- **Line 55-66:** `construction` block in `VERTICAL_COMPLIANCE`:
  - `primaryFramework: 'RIDDOR'` (line 56)
  - `riddorApplies: true` (line 59)
  - `patientIsWorker: true` (line 60)
  - `reportFormLabel: 'HSE F2508 RIDDOR Report'` (line 61)
- `getVerticalCompliance('construction')` (line 209-211) returns this block directly.
- Status: **PASS**

**File:** `services/taxonomy/vertical-outcome-labels.ts`

- **Line 122:** `construction:      'Worker',` inside the `labels` object in `getPatientLabel()`.
- `getPatientLabel('construction')` returns `'Worker'`.
- Status: **PASS**

## Files Created/Modified

None. This plan is read-only. All verified files were opened for inspection only.

## Decisions Made

None — followed plan as specified. All construction paths were correctly wired prior to this plan.

## Deviations from Plan

None — plan executed exactly as written.

## Issues Encountered

None. All five must-have truths verified cleanly on first read.

## User Setup Required

None — no external service configuration required.

## Next Phase Readiness

- Phase 18.5 complete (2/2 plans executed and verified).
- All construction vertical infrastructure is confirmed correct and ready for production use.
- Phase 19 (Motorsport Vertical) is next. Blocked by: obtain physical Motorsport UK Accident Form from Incident Pack V8.0 before building `motorsport-incident-generator` Edge Function (per research flag in STATE.md).
- No code blockers — motorsport paths already have 501 stubs in the dispatcher.

---
*Phase: 18.5-construction-infrastructure-vertical*
*Completed: 2026-02-18*
