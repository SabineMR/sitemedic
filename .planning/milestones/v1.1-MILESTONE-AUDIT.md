---
milestone: v1.1
audited: 2026-02-17T21:15:00Z
status: tech_debt
scores:
  requirements: 32/33
  phases: 9/9
  integration: 12/12
  flows: 5/5
gaps:
  requirements:
    - "Phase 13: Geofence coverage analytics (% booking sites covered) — not implemented (Phase 17 planned)"
tech_debt:
  - phase: 10-realtime-ops-polish
    items:
      - "useMedicLocationsStore.ts:332–337 — useEffect inside window !== undefined check (redundant guard, harmless in browser)"
  - phase: 12-analytics-dashboard
    items:
      - "Analytics overview tab queries 5 legacy DB views with no org_id filter — acceptable for single-tenant, gap for multi-tenant"
  - phase: 06.5-payments-payouts
    items:
      - "payout-summary.tsx is dead code — never imported; payout cycle uses TimesheetBatchApproval instead. Two orphaned API routes: /api/payouts/process-batch and /api/payouts/calculate-weekly"
resolved_since_last_audit:
  - "GAP-1 (Critical): Payslip query now uses medic.id — Flow 4 COMPLETE"
  - "GAP-2 (High): RIDDOR draft editing now has bound UI inputs — Flow 3 COMPLETE"
  - "Phase 13 previously unverified — VERIFICATION.md now present (13/13 must-haves)"
  - "console.warn removed from useMedicLocationsStore.ts"
---

# v1.1 Milestone Audit Report (Re-audit)

**Milestone:** v1.1 — Post-MVP Polish & Data Completeness
**Audited:** 2026-02-17 (re-audit after Phase 16)
**Status:** tech_debt
**Auditor:** Claude (gsd-audit-milestone orchestrator + gsd-integration-checker)

---

## Summary

v1.1 has closed all critical gaps. Both blocking bugs from the first audit (payslip empty list + RIDDOR draft editing) are fixed and verified. All 5 E2E flows are now complete. 9/9 phases are verified. The one remaining open requirement — geofence coverage analytics — is a medium-priority deferred feature that does not break any existing flow. Phase 17 is declared in the roadmap to implement it.

---

## Phase Verification Status

| Phase | Name | Status | Score | Notes |
|-------|------|--------|-------|-------|
| 08 | Lead Capture | ✅ passed | 13/13 | — |
| 09 | Booking Data Completeness | ✅ passed | 4/4 | — |
| 10 | Realtime Ops Polish | ✅ passed | 7/7 | 1 hook warning (non-blocking) |
| 11 | Org Settings | ✅ passed | 10/10 | — |
| 12 | Analytics Dashboard | ✅ passed | 9/9 | Overview tab org_id gap (legacy) |
| 13 | UX Polish | ✅ passed | 13/13 | Previously unverified — now verified |
| 14 | Compliance Exports | ✅ passed | 5/5 | — |
| 15 | Code Quality | ✅ passed | 16/16 | — |
| 16 | Critical Bug Fixes | ✅ passed | 5/5 | Closed GAP-1 and GAP-2 |

---

## Requirements Coverage

### Phase 08 — Lead Capture

| Requirement | Status |
|-------------|--------|
| Contact form persisted to DB, no email-only | SATISFIED |
| Quote submissions persisted (session data not lost) | SATISFIED |
| Admin CRM with lead status (new/contacted/converted/closed) | SATISFIED |
| Quote-to-booking shortcut with data pre-fill | SATISFIED |

### Phase 09 — Booking Data Completeness

| Requirement | Status |
|-------------|--------|
| Client sees specialNotes + what3words on confirmation | SATISFIED |
| Admin sees approval_reason, cancellation_reason, cancelled_by | SATISFIED |
| Recurring booking chain shows all N instances with status | SATISFIED |
| Refund amount visible in admin view when > 0 | SATISFIED |

### Phase 10 — Realtime Ops Polish

| Requirement | Status |
|-------------|--------|
| Map marker shows medic name + site + shift times | SATISFIED |
| Payment failure page has retry button | SATISFIED |
| Alert dismiss prompts for note, logs to medic_alerts | SATISFIED |
| Geofence_failure alert escalates to red pulse after 15 min | SATISFIED |
| Suggested action per alert type (9 types) | SATISFIED |
| Bulk dismiss for low/medium severity only | SATISFIED |
| Contact button fallback to mailto when medicPhone is null | SATISFIED |

### Phase 11 — Org Settings

| Requirement | Status |
|-------------|--------|
| org_settings table with base_rate, geofence_default_radius, urgency_premiums, admin_email | SATISFIED |
| Admin settings page at /admin/settings | SATISFIED |
| Booking pricing reads base_rate from org settings | SATISFIED |
| Geofence creation defaults to org's geofence_default_radius | SATISFIED |
| Urgency premium validation reads from org settings | SATISFIED |

### Phase 12 — Analytics Dashboard

| Requirement | Status |
|-------------|--------|
| Territory coverage heatmap + hiring trigger cards | SATISFIED |
| Auto-assignment success rate chart (12 weeks) | SATISFIED |
| Medic utilisation table sortable by utilisation % | SATISFIED |
| Out-of-territory booking frequency and cost impact | SATISFIED |
| Late arrival pattern heatmap | SATISFIED |
| Multi-tenant org_id isolation on all queries | PARTIAL — new analytics tabs isolated, 5 legacy overview DB views are cross-org |

### Phase 13 — UX Polish

| Requirement | Status |
|-------------|--------|
| Skeleton loaders: treatments, workers, organizations, command center | SATISFIED |
| Geofence creation: interactive Leaflet map picker (click to place, drag to resize) | SATISFIED |
| Geofence real-time exit alert creates medic_alert type geofence_failure | SATISFIED |
| **Geofence coverage analytics: % of booking sites covered** | **UNSATISFIED — Phase 17 declared to implement** |
| RIDDOR auto-save draft every 30 seconds | SATISFIED — Phase 16 added UI inputs |
| RIDDOR detail: audit trail with status changes + timestamp + actor | SATISFIED |
| RIDDOR detail: photo gallery for evidence photos | SATISFIED |

### Phase 14 — Compliance Exports

| Requirement | Status |
|-------------|--------|
| Medic payslip PDF download (2 clicks) | SATISFIED — Phase 16 fixed medic_id query |
| Admin exports RIDDOR incidents as PDF | SATISFIED |
| Certification expiry banners on medic profile | SATISFIED |
| IR35 status + last assessment date on medic profile | SATISFIED |
| Contract version history with signed URL downloads | SATISFIED |

### Phase 15 — Code Quality

| Requirement | Status |
|-------------|--------|
| Zero console.log in production (web/app/**) | SATISFIED |
| Admin manually assigns medic to unmatched booking | SATISFIED |
| Schedule board empty state (no mock data) | SATISFIED |
| Schedule board conflict checking in production data | SATISFIED |

### Phase 16 — Critical Bug Fixes

| Requirement | Status |
|-------------|--------|
| Payslip page uses medic.id (not user.id) in timesheets query | SATISFIED |
| RIDDOR draft editing: category select + override reason textarea | SATISFIED |
| Zero console.warn in production stores | SATISFIED |

---

## Total: **32/33 requirements satisfied**

---

## Cross-Phase Integration

| Connection | Status | Details |
|------------|--------|---------|
| Phase 08→11: contact/quotes routes read org_settings admin_email | ✅ WIRED | Both routes query org_settings after DB insert |
| Phase 09→15: BookingDetailPanel + match endpoint manual override | ✅ WIRED | No conflict — reuse existing overrideMedicId field |
| Phase 10→13: onPingReceived + useGeofenceExitMonitor | ✅ WIRED | Callback registered after loadGeofences(), cleanup on unmount |
| Phase 11→08: booking form reads base_rate, quote prefill flows | ✅ WIRED | Two flows (public + admin) both correct |
| Phase 13→10: geofence_failure alert type in AlertPanel | ✅ WIRED | SUGGESTED_ACTIONS and getAlertIcon both handle geofence_failure |
| Phase 12→11: new analytics tabs org_id isolation | ✅ WIRED | All 3 new tabs use .eq('org_id', orgId) via useRequireOrg() |
| Phase 16→14: payslip page now uses medic.id | ✅ WIRED | timesheets.medic_id FK correctly resolved |
| Phase 16→13: RIDDOR detail page draft inputs wired to auto-save | ✅ WIRED | onChange handlers update state → useEffect deps → 30s debounce |
| Phase 12 overview tab: legacy DB view queries | ⚠️ PARTIAL | 5 views have no org_id filter — cross-org aggregates in multi-tenant |

---

## E2E Flow Verification

| Flow | Steps | Status | Notes |
|------|-------|--------|-------|
| 1. Lead → Booking conversion | Contact form → DB → /admin/submissions → Convert → /admin/bookings/new pre-filled | ✅ COMPLETE | — |
| 2. Booking → Medic → Live monitoring | Create booking → Auto-assign → Command center map marker → Geofence exit → AlertPanel | ✅ COMPLETE | — |
| 3. RIDDOR compliance workflow | Medic logs → Sync → Auto-flag → Admin reviews draft → Auto-save → Status change → Audit trail | ✅ COMPLETE | Was PARTIAL — GAP-2 now fixed |
| 4. Medic payout cycle | Booking completed → Timesheet → Admin approves → Payslip → Medic downloads PDF | ✅ COMPLETE | Was BROKEN — GAP-1 now fixed |
| 5. Analytics → Operational decisions | Territory metrics → Hiring trigger cards → Coverage gaps → Org settings → Adjust base_rate | ✅ COMPLETE (with tech debt) | 5 legacy views lack org_id filter |

---

## Tech Debt

### Phase 10: React Hook Ordering Warning

`useMedicLocationsStore.ts:332–337` — `useEffect` called inside `if (typeof window !== 'undefined')` block. Redundant guard (React's useEffect never runs in SSR). Does not crash in browser context. Low risk.

### Phase 12: Analytics Overview Tab Cross-Org Queries

`web/app/admin/analytics/page.tsx` — 5 legacy DB view queries (`location_tracking_metrics`, `medic_location_analytics`, `daily_location_trends`, `geofence_performance`, `alert_type_summary`) have no `.eq('org_id', orgId)` filter. Acceptable for current single-tenant deployment. Medium risk for multi-tenant.

### Phase 06.5: Orphaned Payout Component + Routes

`web/components/admin/payout-summary.tsx` — exported but never imported or rendered anywhere. Payout cycle operates correctly via `TimesheetBatchApproval`. Two API routes are consequently orphaned:
- `POST /api/payouts/process-batch`
- `GET /api/payouts/calculate-weekly`

These are dead code but do not break any flow.

---

## Unimplemented Feature (Phase 17)

### GAP-3: Geofence Coverage Analytics

**ROADMAP.md Phase 13 requirement:** "Geofence coverage analytics: show % of booking sites covered by at least one active geofence"

**Status:** Not implemented. No component, API route, or query computes this metric.

**Resolution:** Phase 17 is declared in ROADMAP.md with goal: "Surface the % of active booking sites covered by at least one geofence — the Phase 13 requirement that was deferred during implementation."

Phase 17 has no plans yet. Run `/gsd:plan-phase 17` to begin.

---

## Recommendation

**Status: tech_debt** — all critical gaps closed, all E2E flows complete. One unimplemented feature (geofence coverage analytics) deferred to Phase 17.

Options:
1. **Execute Phase 17** then re-audit for full 33/33 satisfaction
2. **Complete milestone** now (accept GAP-3 + tech debt as known items, defer to v1.2)

---

*Audited: 2026-02-17*
*Auditor: Claude (gsd-audit-milestone + gsd-integration-checker)*
